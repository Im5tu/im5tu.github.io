<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Stuart Blackler "><meta name="description" content="A brief overview of cookies, why we want them to be httpOnly and how we can ensure this via URL Rewrite."><meta name="keywords" content=",IIS,Url Rewrite,Cookies,devops"><meta name="robots" content="noodp"><meta name="theme-color" content><link rel="canonical" href="https://im5tu.io/article/2017/06/ensuring-httponly-cookies-with-url-rewrite/"><title>Ensuring httpOnly cookies with URL Rewrite :: CodeWithStu's Blog</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://im5tu.io/main.b78c3be9451dc4ca61ca377f3dc2cf2e6345a44c2bae46216a322ef366daa399.css" integrity="sha256-t4w76UUdxMphyjd/PcLPLmNFpEwrrkYhajIu82bao5k="><link rel="apple-touch-icon" sizes="180x180" href="https://im5tu.io/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://im5tu.io/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://im5tu.io/favicon-16x16.png"><link rel="manifest" href="https://im5tu.io/site.webmanifest"><link rel="mask-icon" href="https://im5tu.io/safari-pinned-tab.svg" color><link rel="shortcut icon" href="https://im5tu.io/favicon.ico"><meta name="msapplication-TileColor" content><meta itemprop="name" content="Ensuring httpOnly cookies with URL Rewrite"><meta itemprop="description" content="A brief overview of cookies, why we want them to be httpOnly and how we can ensure this via URL Rewrite."><meta itemprop="datePublished" content="2017-06-06T15:01:04+01:00"><meta itemprop="dateModified" content="2017-06-06T15:01:04+01:00"><meta itemprop="wordCount" content="546"><meta itemprop="keywords" content="IIS,Url Rewrite,Cookies,devops,"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ensuring httpOnly cookies with URL Rewrite"><meta name="twitter:description" content="A brief overview of cookies, why we want them to be httpOnly and how we can ensure this via URL Rewrite."><meta property="og:title" content="Ensuring httpOnly cookies with URL Rewrite"><meta property="og:description" content="A brief overview of cookies, why we want them to be httpOnly and how we can ensure this via URL Rewrite."><meta property="og:type" content="article"><meta property="og:url" content="https://im5tu.io/article/2017/06/ensuring-httponly-cookies-with-url-rewrite/"><meta property="article:section" content="article"><meta property="article:published_time" content="2017-06-06T15:01:04+01:00"><meta property="article:modified_time" content="2017-06-06T15:01:04+01:00"><meta property="og:see_also" content="https://im5tu.io/article/2017/06/ensuring-samesite-cookies-with-url-rewrite/"><meta property="og:see_also" content="https://im5tu.io/article/2017/06/ensuring-secure-cookies-with-url-rewrite/"><meta property="og:see_also" content="https://im5tu.io/article/2017/06/removing-trailing-slashes-with-url-rewrite/"><meta property="og:see_also" content="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/"><meta property="og:see_also" content="https://im5tu.io/article/2017/06/up-and-running-with-url-rewrite-going-from-http-to-https/"><meta property="article:section" content="Development"><meta property="article:published_time" content="2017-06-06 15:01:04 +0100 +0100"><meta property="og:image" content="https://im5tu.io/img/profile.png"><meta property="og:site_name" content="CodeWithStu's Blog"><link rel="alternate" type="application/rss+xml" href="https://im5tu.io/article/index.xml" title="Stuart Blackler's Blog"><link rel="preconnect" href="https://api.github.com"><link rel="preconnect" href="https://partner.googleadservices.com"><link rel="preconnect" href="https://tpc.googlesyndication.com"><link rel="preconnect" href="https://www.googletagservices.com"><link rel="preconnect" href="https://googleads.g.doubleclick.net"><link rel="preconnect" href="https://pagead2.googlesyndication.com"><link rel="preload" href="https://im5tu.io/fonts/Inter-UI-Bold.woff2"><link rel="preload" href="https://im5tu.io/fonts/Inter-UI-Regular.woff2"><style>.post{max-width:1200px}.header__inner{width:100%;max-width:1160px}.logo__cursor{background:#3b82f6}.toolbar{display:none!important}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border-left:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2;border-radius:0;border-bottom-left-radius:10px;transition:all 250ms ease;margin:-18px;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}table{width:100%;border-collapse:collapse}table th{background-color:#cecece;color:#222}table tr{margin:0;padding:0}table tr:first-child{border-left:1px solid #acacac;border-top:1px solid #acacac;border-right:1px solid #acacac}table tr td:first-child{border-left:1px solid #acacac}table tr td:last-child{border-right:1px solid #acacac}table td,table th{padding:.5em;border-bottom:1px solid #acacac;margin:0}h2{margin-top:1.5em}h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{text-decoration:none}h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover{text-decoration:underline}#promotions img{margin:20px auto}#sponsorMessage{width:100%;background:#ffdf00;color:#242325;padding:10px;font-size:.9em}.flex-container{width:100%;display:inline-flex;justify-content:space-between}.flex-box{display:block}.hidden{display:hidden}.post-title{font-weight:700}.post-summary{font-style:italic;font-size:.8em;color:#222}.post-tags{font-size:.9em}.post-tags span.tag{margin:0 .5em;color:#111;text-decoration:underline}@media print{.copy-code-button{display:none}}@media(prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}.post-summary,.post-tags span.tag{color:#eaeaea}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-QLMVXHCJ5K"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QLMVXHCJ5K")</script><script data-ad-client="ca-pub-8597760177900459" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div class="container"><header class="header"><span class="header__inner"><a href="https://im5tu.io/" style="text-decoration:none"><div class="logo"><span class="logo__mark">></span>
<span class="logo__text">im5tu.io</span>
<span class="logo__cursor"></span></div></a><span class="header__right"><nav class="menu"><ul class="menu__inner"><li><a href="https://im5tu.io/article/">Blog</a></li><li><a href="https://news.codewithstu.tv">Newsletter</a></li><li><a href="https://www.patreon.com/CodeWithStu">Patreon</a></li><li><a href="https://im5tu.io/article/index.xml">RSS</a></li><li><a href="https://twitter.com/CodeWithStu">Twitter</a></li><li><a href="https://codewithstu.tv">YouTube</a></li></ul></nav><span class="menu-trigger"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class="content"><main class="post"><div style="font-style:italic;width:100%;background-color:#ffe12b;color:#333;text-align:center;padding:1px"><p>This page is available to sponsor. <a id="sponsorLink" href="https://im5tu.io/sponsorship/" ref="nofollow" target="_blank">Click Here</a> for more details!</p></div><div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 minutes</p></div><article><h1 class="post-title"><a href="https://im5tu.io/article/2017/06/ensuring-httponly-cookies-with-url-rewrite/">Ensuring httpOnly cookies with URL Rewrite</a></h1><hr><aside id="toc"><div class="toc-title">Table of Contents</div><nav id="TableOfContents"><ul><li><a href="#what-are-cookies">What are cookies?</a></li><li><a href="#what-are-httponly-cookies">What are httpOnly cookies?</a></li><li><a href="#how-can-we-ensure-our-cookies-are-httponly-with-url-rewrite">How can we ensure our cookies are httpOnly with URL Rewrite</a></li></ul></nav></aside><hr><div class="post-content"><div style="font-style:italic;width:100%;background-color:#63e5ff;color:#333;text-align:center;padding:5px"><p>This post is part of the <a href="#series" style="font-weight:700">Url Rewriting</a> series.</p></div><p>In this article, I will give a brief overview of cookies, why we want them to be httpOnly and how we can ensure this via URL Rewrite. We will also be creating our first outbound rewrite rule with a pre-condition.</p><p>See my <a href="https://im5tu.io/article/2017/06/removing-trailing-slashes-with-url-rewrite/">previous posts</a> for information on inbound rewrite rules.</p><h2 id="what-are-cookies">What are cookies?</h2><p>Unfornately, in this sense they are not a snack. They are, usually, small bits of information continually transferred between the browser and the server in order to do things like session tracking & identification, or maintain informantion pertainent to your browsing session. If not secured in the right way, you can expose details of your browsing session unknowingly. First up, we can make the cookies <code>httpOnly</code>.</p><h2 id="what-are-httponly-cookies">What are httpOnly cookies?</h2><p>By adding the modifier to the cookie, we prevent any scripts running from accessing the cookie. The biggest benefit here is protection against Cross-Site Scripting, or XSS. Unless you have very specific requirements for cookies, this flag should always be enabled.</p><p><em>For more information, checkout <a href="https://scotthelme.co.uk/tough-cookies/">Scott Helme&rsquo;s incredible post</a> on getting tougher cookies.</em></p><h2 id="how-can-we-ensure-our-cookies-are-httponly-with-url-rewrite">How can we ensure our cookies are httpOnly with URL Rewrite</h2><p>When a server indicates that it wants to set a cookie, it does so by sending the <code>Set-Cookie</code> HTTP header along with the response. There are a few modifiers that this can have to make them more secure in compliant browsers (eg: Chrome, Firefox, Edge, Safari): <code>httpOnly</code>, <code>secure</code> and <code>sameSite=(lax|strict)</code>.</p><p>This rewrite snippet requires two portions: the rule and a set of precondtions.</p><pre><code class="language-xml">&lt;rewrite&gt;
    &lt;outboundRules&gt;
        &lt;rule name=&quot;Ensure httpOnly Cookies&quot; preCondition=&quot;Missing httpOnly cookie&quot;&gt;
            &lt;match serverVariable=&quot;RESPONSE_Set_Cookie&quot; pattern=&quot;.*&quot; negate=&quot;false&quot; /&gt;
            &lt;action type=&quot;Rewrite&quot; value=&quot;{R:0}; HttpOnly&quot; /&gt;
        &lt;/rule&gt;
        &lt;preConditions&gt;
            &lt;preCondition name=&quot;Missing httpOnly cookie&quot;&gt;
                &lt;!-- Don't remove the first line! --&gt;
                &lt;add input=&quot;{RESPONSE_Set_Cookie}&quot; pattern=&quot;.&quot; /&gt;
                &lt;add input=&quot;{RESPONSE_Set_Cookie}&quot; pattern=&quot;; HttpOnly&quot; negate=&quot;true&quot; /&gt;
            &lt;/preCondition&gt;
        &lt;/preconditions&gt;
    &lt;/outboundRules&gt;
&lt;/rewrite&gt;
</code></pre><p>Within our rule, we are defining the name of the rule which can be viewed inside of <code>inetmgr (IIS Manager)</code>. In previous posts we have added the attribute to stop processing, but here we want to continue processing rewrite rules because we may want to do additional work to the response. Next, we match the server varible for a <code>Set-Cookie</code> HTTP header (<code>RESPONSE_Set_Cookie</code>) and ensure that it&rsquo;s present for us to continue. For our action, we rewrite the <code>Set-Cookie</code> header to be the original value, with the <code>HttpOnly</code> modifier appended.</p><p>Within the precondition, which is matched by name to the <code>preCondition</code> attribute in the rule, we do two things:</p><ul><li>(<em>I think, see below</em>) Make sure that the <code>Set-Cookie</code> header has been set (via the server variable <code>{RESPONSE_Set_Cookie}</code>);</li><li>Make sure that we do not already have the <code>HttpOnly</code> modifier set</li></ul><p>For an unknown reason, probably due to a knowledge gap, the first line is required. I have made a guess as to what this could be, but I am unsure. Strange things happen in the dev tools in Chrome if that first line is not there.</p><p><em>It is worth noting that a precondition is not limited to a single rule, it can be re-used. There is probably scope for making this rule smaller, if there is i&rsquo;ll edit the post to reflect the smaller rule.</em></p><p>That&rsquo;s it. If you check your debug tool of choice after implementing this, you should see that all cookies are now sent with the <code>HttpOnly</code> modifier.</p></div></article><hr><div id="recommended"><h4>Book Recommendations</h4><p><i>The books below are ones I would personally buy again. All links are redirect to Amazon.</i></p><div class="flex-container"><div class="flex-box"><a href="https://geni.us/P3Jlg4" target="_blank" ref="nofollow"><img src="https://im5tu.io/img/affiliates/Book1.jpg" width="150" height="200" alt="Writing High Performance .NET Code"></a></div><div class="flex-box"><a href="https://geni.us/qEg8Cx" target="_blank" ref="nofollow"><img src="https://im5tu.io/img/affiliates/Book2.jpg" width="150" height="200" alt="Pro .NET Memory Management"></a></div><div class="flex-box"><a href="https://geni.us/k8HBxBA" target="_blank" ref="nofollow"><img src="https://im5tu.io/img/affiliates/Book3.jpg" width="150" height="200" alt="Pro .NET Benchmarking"></a></div><div class="flex-box"><a href="https://geni.us/4b2QcS" target="_blank" ref="nofollow"><img src="https://im5tu.io/img/affiliates/Book4.jpg" width="150" height="200" alt="Designing Data-Intensive Applications"></a></div></div></div><hr><div class="post-info"><a name="series"></a>
<b>More in the Url Rewriting series:</b><ol><li><a href="https://im5tu.io/article/2017/06/up-and-running-with-url-rewrite-going-from-http-to-https/">Up and running with URL Rewrite - going from HTTP to HTTPS</a></li><li><a href="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/">Canonical host urls with URL Rewrite</a></li><li><a href="https://im5tu.io/article/2017/06/removing-trailing-slashes-with-url-rewrite/">Removing trailing slashes with URL Rewrite</a></li><li><b>Ensuring httpOnly cookies with URL Rewrite <i>(This article)</i></b></li><li><a href="https://im5tu.io/article/2017/06/ensuring-secure-cookies-with-url-rewrite/">Ensuring secure cookies with URL Rewrite</a></li><li><a href="https://im5tu.io/article/2017/06/ensuring-samesite-cookies-with-url-rewrite/">Ensuring samesite cookies with URL Rewrite</a></li></ol><p><a href="https://im5tu.io/series/url-rewriting/">View All Articles</a></p><hr><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class="tag"><a href="https://im5tu.io/tags/iis/">IIS</a></span><span class="tag"><a href="https://im5tu.io/tags/url-rewrite/">Url Rewrite</a></span><span class="tag"><a href="https://im5tu.io/tags/cookies/">Cookies</a></span><span class="tag"><a href="https://im5tu.io/tags/devops/">devops</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>546 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2017-06-06 14:01 +0000</p></div><hr><div id="promotions"><a href="https://geni.us/cws-springer" target="_blank"><img src="https://www.awltovhc.com/image-100677210-15518210" width="728" height="90" alt="Apress eBook Sale is here now! - Order selected eBooks for $12.99 each. (3rd-20th May)"></a>
<a href="https://geni.us/cws-namecheap" target="_blank"><img src="https://www.awltovhc.com/image-100677210-14326263" width="728" height="90" alt="Popular Domains for just 99 Cents at Namecheap!"></a>
<a href="https://geni.us/cws-mailchimp" target="_blank"><img src="https://www.ftjcfx.com/image-100677210-15488213" width="728" height="90" alt="See upto 88% more revenue with predictive segments!"></a></div><hr><script src="https://utteranc.es/client.js" repo="Im5tu/im5tu.github.io" issue-term="url" label="Comment" theme="photon-dark" crossorigin="anonymous" async></script><div class="pagination"><div class="pagination__title"><span class="pagination__title-h"></span><hr></div><div class="pagination__buttons"><span class="button previous"><a href="https://im5tu.io/article/2017/06/ensuring-secure-cookies-with-url-rewrite/"><span class="button__icon">←</span>
<span class="button__text">Ensuring secure cookies with URL Rewrite</span></a></span>
<span class="button next"><a href="https://im5tu.io/article/2017/06/removing-trailing-slashes-with-url-rewrite/"><span class="button__text">Removing trailing slashes with URL Rewrite</span>
<span class="button__icon">→</span></a></span></div></div></main></div><footer class="footer"><hr><div class="footer__inner"><div class="footer__content"><iframe src="https://codewithstu.substack.com/embed" width="480" height="320" style="border:1px solid #eee;background:#fff" frameborder="0" scrolling="no"></iframe></div></div><hr><div><div class="footer__inner"><div class="footer__content"><span>&copy; 2023</span>
<span><a href="https://im5tu.io/">Stuart Blackler</a></span>
<span><a href="https://im5tu.io/article/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div><p><a href="https://im5tu.io/tags">Tags</a> | <a href="https://im5tu.io/categories">Categories</a> | <a href="https://im5tu.io/sitemap.xml">Sitemap</a></p></div><div><p>This site uses Google Analytics for Analytics only, so may contain cookies.</p></div></div></footer></div><script type="text/javascript" src="https://im5tu.io/bundle.min.205d491810c28f95aa953fae884e1c27abe13fdf93ec63b882d0036b248d4a6282eb2d134e4e7225c6ad6e86db87b08488a361ca4a7383d01fcff43f3d57b9c3.js" integrity="sha512-IF1JGBDCj5WqlT+uiE4cJ6vhP9+T7GO4gtADaySNSmKC6y0TTk5yJcatbobbh7CEiKNhykpzg9Afz/Q/PVe5ww=="></script>
<script src="https://im5tu.io/js/site-376a1eef.js" defer></script></body></html>
<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="Stuart Blackler ">
<meta name=description content="Learn how to setup ASPNET Core Versioning for Minimal APIs">
<meta name=keywords content=",aspnetcore,dotnet,YouTube">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://im5tu.io/article/2022/10/asp.net-core-versioning-minimal-apis/>
<title>
ASP.NET Core Versioning: Minimal APIs :: Stuart Blackler's Blog
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<meta name=msapplication-TileColor content>
<meta itemprop=name content="ASP.NET Core Versioning: Minimal APIs">
<meta itemprop=description content="Learn how to setup ASPNET Core Versioning for Minimal APIs"><meta itemprop=datePublished content="2022-10-04T12:00:00+01:00">
<meta itemprop=dateModified content="2022-10-04T12:00:00+01:00">
<meta itemprop=wordCount content="1143">
<meta itemprop=keywords content="aspnetcore,dotnet,YouTube,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="ASP.NET Core Versioning: Minimal APIs">
<meta name=twitter:description content="Learn how to setup ASPNET Core Versioning for Minimal APIs">
<meta property="og:title" content="ASP.NET Core Versioning: Minimal APIs">
<meta property="og:description" content="Learn how to setup ASPNET Core Versioning for Minimal APIs">
<meta property="og:type" content="article">
<meta property="og:url" content="https://im5tu.io/article/2022/10/asp.net-core-versioning-minimal-apis/"><meta property="article:section" content="article">
<meta property="article:published_time" content="2022-10-04T12:00:00+01:00">
<meta property="article:modified_time" content="2022-10-04T12:00:00+01:00">
<meta property="og:see_also" content="https://im5tu.io/article/2022/09/asp.net-core-versioning-mvc-apis/">
<meta property="article:section" content="aspnetcore">
<meta property="article:section" content="dotnet">
<meta property="article:section" content="YouTube">
<meta property="article:published_time" content="2022-10-04 12:00:00 +0100 +0100">
<link rel=alternate type=application/rss+xml href=https://im5tu.io/article/2022/10/asp.net-core-versioning-minimal-apis/index.xml title="Stuart Blackler's Blog">
<meta property="og:image" content="https://im5tu.io/img/profile.png">
<meta property="og:site_name" content="Stuart Blackler's Blog">
<link rel=alternate type=application/rss+xml href=/index.xml title="Stuart Blackler's Blog">
<link rel=preconnect href=https://api.github.com>
<link rel=preconnect href=https://partner.googleadservices.com>
<link rel=preconnect href=https://tpc.googlesyndication.com>
<link rel=preconnect href=https://www.googletagservices.com>
<link rel=preconnect href=https://googleads.g.doubleclick.net>
<link rel=preconnect href=https://pagead2.googlesyndication.com>
<link rel=preload href=/fonts/Inter-UI-Bold.woff2>
<link rel=preload href=/fonts/Inter-UI-Regular.woff2>
<style>.post{max-width:1200px}.header__inner{width:100%;max-width:1160px}.toolbar{display:none!important}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border-left:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2;border-radius:0;border-bottom-left-radius:10px;transition:all 250ms ease;margin:-18px;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}table{width:100%;border-collapse:collapse}table th{background-color:#cecece;color:#222}table tr{margin:0;padding:0}table tr:first-child{border-left:1px solid #acacac;border-top:1px solid #acacac;border-right:1px solid #acacac}table tr td:first-child{border-left:1px solid #acacac}table tr td:last-child{border-right:1px solid #acacac}table td,table th{padding:.5em;border-bottom:1px solid #acacac;margin:0}h2{margin-top:1.5em}h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{text-decoration:none}h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover{text-decoration:underline}#promotions img{margin:20px auto}#sponsorMessage{width:100%;background:#f2cc8f;color:#242325;padding:10px;font-size:.9em}.flex-container{width:100%;display:inline-flex;justify-content:space-between}.flex-box{display:block}.hidden{display:hidden}@media print{.copy-code-button{display:none}}@media(prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}}</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QLMVXHCJ5K"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QLMVXHCJ5K')</script>
<script data-ad-client=ca-pub-8597760177900459 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>im5tu.io</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/article/>Blog</a></li><li><a href=https://discord.codewithstu.tv>Discord</a></li><li><a href=https://news.codewithstu.tv>Newsletter</a></li><li><a href=https://www.patreon.com/CodeWithStu>Patreon</a></li><li><a href=/article/index.xml>RSS</a></li><li><a href=https://twitter.com/CodeWithStu>Twitter</a></li><li><a href=https://codewithstu.tv>YouTube</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<a id=sponsorLink href=/sponsorship ref=nofollow target=_blank>
<div id=sponsorMessage class=hidden></div>
</a>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>6 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://im5tu.io/article/2022/10/asp.net-core-versioning-minimal-apis/>ASP.NET Core Versioning: Minimal APIs</a>
</h1>
<hr>
<aside id=toc>
<div class=toc-title>Table of Contents</div>
<nav id=TableOfContents>
<ul>
<li><a href=#versioning-setup>Versioning Setup</a></li>
<li><a href=#versioning-strategy>Versioning Strategy</a></li>
<li><a href=#adding-versions-to-minimal-apis>Adding versions to Minimal APIs</a></li>
<li><a href=#versioning-via-headers>Versioning via Headers</a></li>
<li><a href=#versioning-via-querystrings>Versioning via QueryStrings</a></li>
<li><a href=#versioning-via-urls>Versioning via URLs</a></li>
<li><a href=#other-versioning-options>Other versioning options</a></li>
</ul>
</nav>
</aside>
<hr>
<div class=post-content>
<section class="series series-header">
<p><i>This article is part of the <a href=#series>API Versioning</a> series. You are reading part 2 of 2.</i></p>
</section>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/YRJGKyzjFlY style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
<p><em>This blog post is also available as a video on my <a href=https://codewithstu.tv>YouTube Channel</a>.</em></p>
<p>If your API is a key part of your product you are going to want to version your APIs. One of the major reasons that we consider versioning our api’s is so that we provide a consistent experience for our users. If we consistently change our API’s then our consumers will break, they will get annoyed and eventually leave our product.</p>
<p>There are three main ways that you can version your API’s:</p>
<ul>
<li>Headers</li>
<li>Querystring</li>
<li>Urls</li>
</ul>
<p>I don’t believe there is a right way to do versioning, so I am going to show you all three approaches in this article and let you decide which one is best for your scenario. The article specifically looks at ASP.NET Core Minimal APIs. For MVC APIs, go <a href=/article/2022/09/asp.net-core-versioning-mvc-apis/>here</a>.</p>
<h2 id=versioning-setup>Versioning Setup</h2>
<p>Depending on whether we are working with Minimal APIs or MVC depends on which NuGet package we need to add. For MVC based APIs we need to add the <code>Asp.Versioning.Http</code> package from NuGet.</p>
<p>It’s worth noting that the name of this package has changed from the previous <code>Microsoft.AspNetCore.Mvc.Versioning</code> package because the main contributor to the repository has now left Microsoft and can’t reuse the Microsoft prefix. You can read more about this <a href=https://github.com/dotnet/aspnet-api-versioning/discussions/807>here</a>.</p>
<p>Once we’ve add the correct NuGet package for our API type, we can head over to our service collection and call <code>AddApiVersioning</code> - we will want the options later on, so I’m going to setup that lambda function now:</p>
<pre><code class=language-csharp>using Asp.Versioning;
using Asp.Versioning.Conventions;

var version1 = new ApiVersion(1);
var version2 = new ApiVersion(2);

var builder = WebApplication.CreateBuilder(args);
builder.Services.AddApiVersioning(options =&gt;
{
    // We will change this later on
});

var app = builder.Build();

app.MapGet(&quot;weather&quot;, (HttpContext context) =&gt;
{
    var apiVersion = context.GetRequestedApiVersion();

    return &quot;Version &quot; + apiVersion?.MajorVersion?.ToString();
});

app.Run();
</code></pre>
<h2 id=versioning-strategy>Versioning Strategy</h2>
<p>One minor thing that you need to consider before you is what style of versioning numbers you’re going to have. For example, I use a major only strategy in which I use a single number to describe a version, eg: v1. Another common versioning strategy is to use a major/minor setup, eg: 1.0.</p>
<p>You’ll also need to consider how much a version covers for an API. For me, I have versioning setup on a per endpoint basis, but I have also seen all endpoints on an API be versioned as one.</p>
<p>There is no right strategy for you to pick here, it all depends on your requirements and what you think is easiest for you to manage vs the experience for your consumers. For the rest of this article, I am going to use my standard setup of major-only versioning on a per endpoint basis.</p>
<h2 id=adding-versions-to-minimal-apis>Adding versions to Minimal APIs</h2>
<p>The setup for a minimal API is a bit different to what we would normally do in the MVC world. First we need to create a version set which tells the API versioning subsystem which versions are available to be used. Here we can set some common options like whether to report API Versions or not:</p>
<pre><code class=language-csharp>var app = builder.Build();
var versionSet = app.NewApiVersionSet()
                    .HasApiVersion(version1)
                    .HasApiVersion(version2)
                    .Build();
</code></pre>
<p>From there we are versioning each endpoint by first calling <code>WithApiVersionSet</code> passing in our version set, before either mapping it to a specific version with <code>MapToApiVersion</code> or making it version agnostic with <code>.IsApiVersionNeutral()</code>:</p>
<pre><code class=language-csharp>app.MapGet(&quot;weather&quot;, (HttpContext context) =&gt;
{
    var apiVersion = context.GetRequestedApiVersion();

    return &quot;Version &quot; + apiVersion?.MajorVersion?.ToString();
})
.WithApiVersionSet(versionSet)
.HasApiVersions(new [] {version1, version2});
</code></pre>
<p>Once this setup is done, for the most part, the api versioning setup is exactly the same in terms of where to get the api version from.</p>
<h2 id=versioning-via-headers>Versioning via Headers</h2>
<p>The first way that we can read the version of the request is to use headers. When using a header, we have two approaches that we can use:</p>
<ul>
<li>We can use an extension to the Accept header</li>
<li>Or we can use a custom header</li>
</ul>
<p>To use the media type we use the options we created earlier to add in:</p>
<pre><code class=language-csharp>builder.Services.AddApiVersioning(options =&gt;
{
    options.ApiVersionReader = new MediaTypeApiVersionReader(&quot;version&quot;);
})
</code></pre>
<p>You can verify this in postman:</p>
<p><img src=/img/api-versioning/media-header.png alt="Verification in Postman using the Accept header"></p>
<p>To use a custom header such as <code>X-Api-Version</code> we need to change the ApiVersionReader to:</p>
<pre><code class=language-csharp>builder.Services.AddApiVersioning(options =&gt;
{
    options.ApiVersionReader = new HeaderApiVersionReader(&quot;X-Api-Version&quot;);
})
</code></pre>
<p>You can verify this in postman:</p>
<p><img src=/img/api-versioning/custom-header.png alt="Verification in Postman using the Custom header"></p>
<h2 id=versioning-via-querystrings>Versioning via QueryStrings</h2>
<p>The next way of versioning our urls is to use a querystring parameter. Here we will change the type of ApiVersionReader to <code>QueryStringApiVersionReader</code> and pass in the name of the parameter that we will use as part of the querystring to provide the version information:</p>
<pre><code class=language-csharp>builder.Services.AddApiVersioning(options =&gt;
{
    options.ApiVersionReader = new QueryStringApiVersionReader(&quot;version&quot;);
})
</code></pre>
<p>You can verify this in postman:</p>
<p><img src=/img/api-versioning/querystring.png alt="Verification in Postman using a querystring"></p>
<h2 id=versioning-via-urls>Versioning via URLs</h2>
<p>The last major way of adding in versioning information is to use URLs. To add the version information to the URL we need to modify the route itself. Instead of changing an attribute like we would in MVC, we just need to edit the route information passed into MapGet, MapPut etc. We put in the new path segment in the exact same way as we did for the MVC route segements, ie: we add a new segment to our URL called <code>version</code> limited to the type <code>apiVersion</code>. This is a special validation that’s created by the versioning package to ensure that correct values are passed in and the correct actions are called:</p>
<pre><code class=language-csharp>app.MapGet(&quot;v{version:apiVersion}/weather&quot;, (HttpContext context) =&gt;
{
    var apiVersion = context.GetRequestedApiVersion();

    return &quot;Version &quot; + apiVersion?.MajorVersion?.ToString();
})
.WithApiVersionSet(versionSet)
.HasApiVersions(new [] {version1, version2});
</code></pre>
<p>Once this is setup for your application, the last bit that we need to do is change the ApiVersionReader in the versioning options. We use the type <code>UrlSegementApiVersionReader</code> to make the package read from the route data instead.</p>
<pre><code class=language-csharp>builder.Services.AddApiVersioning(options =&gt;
{
    options.ApiVersionReader = new UrlSegmentApiVersionReader();
})
</code></pre>
<p>You can verify this in postman:</p>
<p><img src=/img/api-versioning/url.png alt="Verification in Postman using a route parameter"></p>
<h2 id=other-versioning-options>Other versioning options</h2>
<p>There are other things that we can do with this package such as specifying the default version when one is not specified and reporting the supported and deprecated versions in our responses.</p>
<p>To set the default version, we would set the option <code>AssumeDefaultVersionWhenUnspecified</code> to <code>true</code> and then <code>DefaultApiVersion</code> to the default version that you wish to be assumed. Note, that this will only work if you are using the header or querystring versioning strategies.</p>
<p>We can also specify which versions are depreciated and which ones are not. There’s slightly different ways of doing this. In MVC APIs we would set the deprecated flag on the ApiVersion attribute that we decorate our controllers and actions with. For minimal APIs we call <code>HasDepecatedApiVersion</code> with the relevant version number on the version set that we are using. Once this is done, for both MVC and Minimal APIs we set <code>ReportApiVersions</code> equal to true in the options and start getting the headers <code>api-deprecated-versions</code> and <code>api-supported-versions</code> returned as part of responses. These headers contain a comma separated list of supported versions.</p>
<p><em>The full code for this is available to my <a href=https://github.com/sponsors/im5tu>Github Sponsors</a>.</em></p>
</div>
</article>
<hr>
<div id=recommended>
<h4>Book Recommendations</h4>
<p><i>The books below are ones I would personally buy again. All links are redirect to Amazon.</i></p>
<div class=flex-container>
<div class=flex-box><a href=https://geni.us/P3Jlg4 target=_blank ref=nofollow><img src=/img/affiliates/Book1.jpg width=150 height=200></a></div>
<div class=flex-box><a href=https://geni.us/qEg8Cx target=_blank ref=nofollow><img src=/img/affiliates/Book2.jpg width=150 height=200></a></div>
<div class=flex-box><a href=https://geni.us/k8HBxBA target=_blank ref=nofollow><img src=/img/affiliates/Book3.jpg width=150 height=200></a></div>
<div class=flex-box><a href=https://geni.us/4b2QcS target=_blank ref=nofollow><img src=/img/affiliates/Book4.jpg width=150 height=200></a></div>
</div>
</div>
<hr>
<div class=post-info>
<a name=series></a>
<b>More in the API Versioning series:</b>
<ol>
<li><a href=/article/2022/09/asp.net-core-versioning-mvc-apis/>ASP.NET Core Versioning: MVC APIs</a></li>
<li>ASP.NET Core Versioning: Minimal APIs <i>(This article)</i></li>
</ol>
<p><a href=/article/>View All Articles</a></p>
<hr>
<p>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://im5tu.io/tags/aspnetcore/>aspnetcore</a></span><span class=tag><a href=https://im5tu.io/tags/dotnet/>dotnet</a></span><span class=tag><a href=https://im5tu.io/tags/youtube/>YouTube</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1143 Words</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-10-04 11:00 +0000</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h></span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://im5tu.io/article/2023/01/observed-no.-1-vpc-endpoint-policies/>
<span class=button__icon>←</span>
<span class=button__text>Observed No. 1 - VPC Endpoint Policies</span>
</a>
</span>
<span class="button next">
<a href=https://im5tu.io/article/2022/09/asp.net-core-versioning-mvc-apis/>
<span class=button__text>ASP.NET Core Versioning: MVC APIs</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
<hr>
<div id=promotions>
<h4>Offers From My Partners</h4>
<a href=https://bit.ly/cws-apress-jan23 target=_blank>
<img src=https://www.tqlkg.com/image-100677210-15429664 width=300 height=50 alt>
</a>
<a href=https://bit.ly/3S9620C target=_blank>
<img src=https://www.awltovhc.com/image-100677210-15083122 width=728 height=90 alt="Free Domain Privacy">
</a>
</div>
<hr>
<script src=https://utteranc.es/client.js repo=Im5tu/im5tu.github.io issue-term=url label=Comment theme=photon-dark crossorigin=anonymous async></script>
</main>
</div>
<footer class=footer>
<hr>
<div class=footer__inner>
<div class=footer__content>
<iframe src=https://codewithstu.substack.com/embed width=480 height=320 style="border:1px solid #eee;background:#fff" frameborder=0 scrolling=no></iframe>
</div>
</div>
<hr>
<div class=footer__inner>
<div class=footer__content>
<span>&copy; 2023</span>
<span><a href=https://im5tu.io/>Stuart Blackler</a></span>
<span> <a href=https://im5tu.io/article/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<p>This site uses Google Analytics for Analytics only, so may contain cookies.</p>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
<script src=/js/site-453fab6f.js defer></script>
</body>
</html>
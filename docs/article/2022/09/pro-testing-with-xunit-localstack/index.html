<!doctype html><html lang="en"><head><title>Pro Testing with Xunit & Localstack | September | 2022 | Articles | CodeWithStu's Blog</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Learn how to setup Xunit with any docker image using localstack as our example"><meta name="keywords" content><link rel="icon" type="image/x-icon" href="https://im5tu.io/assets/favicon.ico"><link rel="canonical" href="https://im5tu.io/article/2022/09/pro-testing-with-xunit-localstack/"><meta property="og:url" content="https://im5tu.io/article/2022/09/pro-testing-with-xunit-localstack/"><meta property="og:type" content="website"><meta property="og:title" content="Pro Testing with Xunit & Localstack | September | 2022 | Articles | CodeWithStu's Blog"><meta property="og:description" content="Learn how to setup Xunit with any docker image using localstack as our example"><meta property="og:image" content="/assets/profile.jpg"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:domain" content="im5tu.io"><meta property="twitter:url" content="https://im5tu.io/article/2022/09/pro-testing-with-xunit-localstack/"><meta name="twitter:title" content="Pro Testing with Xunit & Localstack | September | 2022 | Articles | CodeWithStu's Blog"><meta name="twitter:description" content="Learn how to setup Xunit with any docker image using localstack as our example"><meta name="twitter:image" content="/assets/profile.jpg"><script defer data-domain="im5tu.io" src="https://plausible.io/js/script.js"></script><style type="text/css">*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::before,::after{--tw-content:''}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,liberation mono,courier new,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}table{width:100%;table-layout:auto;border-collapse:collapse;text-align:left;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}table:where([dir=rtl],[dir=rtl] *){text-align:right}@media(prefers-color-scheme:dark){table{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table th{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity));font-size:.75rem;line-height:1rem;text-transform:uppercase;--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table th{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity));--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table tbody tr{border-bottom-width:1px;--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity));vertical-align:top}@media(prefers-color-scheme:dark){table tbody tr{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity));--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}table td,table th{padding-left:1.5rem;padding-right:1.5rem;padding-top:1rem;padding-bottom:1rem;vertical-align:top}table tbody tr:first-child-of-type(td){white-space:nowrap;font-weight:500;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table tbody tr:first-child-of-type(td){--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}}h1,h2,h3,h4,h5,h6{line-height:1;letter-spacing:-.025em;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}h1,h2,h3{font-weight:800}h1{margin-top:2rem;margin-bottom:2rem;font-size:2.25rem;line-height:2.5rem}@media(min-width:768px){h1{font-size:3rem;line-height:1}}@media(min-width:1024px){h1{font-size:3.75rem;line-height:1}}h2{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1.875rem;line-height:2.25rem}h3{margin-top:1rem;margin-bottom:1rem;font-size:1.5rem;line-height:2rem}h4,h5,h6{margin-top:.75rem;margin-bottom:.75rem;font-weight:700}h4{font-size:1.25rem;line-height:1.75rem}p{padding-top:1rem;padding-bottom:1rem;font-size:1rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity))}p code,li code{font-weight:700;--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}p a:link,p a:visited{font-style:italic;--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}p a:link:hover,p a:visited:hover{--tw-text-opacity:1;color:rgb(154 52 18/var(--tw-text-opacity))}pre>code{display:block;overflow:auto;padding:1.5rem;font-weight:400}ul{list-style-position:inside;list-style-type:disc}ul>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}section ul ul,section ul ol,section ol ul{margin-left:1rem}ol{list-style-position:inside;list-style-type:decimal}ol>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}*,::before,::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.\!relative{position:relative!important}.relative{position:relative}.sticky{position:sticky}.inset-y-0{top:0;bottom:0}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-\[3\.5rem\]{top:3.5rem}.top-\[4\.5rem\]{top:4.5rem}.isolate{isolation:isolate}.z-50{z-index:50}.-m-2{margin:-.5rem}.-m-2\.5{margin:-.625rem}.m-0{margin:0}.-mx-3{margin-left:-.75rem;margin-right:-.75rem}.-my-6{margin-top:-1.5rem;margin-bottom:-1.5rem}.mx-12{margin-left:3rem;margin-right:3rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-3{margin-top:.75rem;margin-bottom:.75rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mb-0{margin-bottom:0}.mb-1{margin-bottom:.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-4{margin-left:1rem}.mt-0{margin-top:0}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.flow-root{display:flow-root}.contents{display:contents}.hidden{display:none}.h-0{height:0}.h-0\.5{height:.125rem}.h-12{height:3rem}.h-4{height:1rem}.h-48{height:12rem}.h-6{height:1.5rem}.h-screen{height:100vh}.w-12{width:3rem}.w-28{width:7rem}.w-4{width:1rem}.w-48{width:12rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.min-w-0{min-width:0}.min-w-\[25\%\]{min-width:25%}.min-w-\[7rem\]{min-width:7rem}.max-w-5xl{max-width:64rem}.max-w-\[1600px\]{max-width:1600px}.max-w-\[30\%\]{max-width:30%}.max-w-screen-xl{max-width:1280px}.max-w-2xl{max-width:42rem}.flex-auto{flex:auto}.flex-shrink-0{flex-shrink:0}.grow{flex-grow:1}.grow-0{flex-grow:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.list-disc{list-style-type:disc}.list-none{list-style-type:none}.flex-col{flex-direction:column}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.space-x-12>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(3rem * var(--tw-space-x-reverse));margin-left:calc(3rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-24>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(6rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(6rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.divide-gray-500\/10>:not([hidden])~:not([hidden]){border-color:rgb(107 114 128/.1)}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-900\/10{border-color:rgb(17 24 39/.1)}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225/var(--tw-border-opacity))}.border-slate-400{--tw-border-opacity:1;border-color:rgb(148 163 184/var(--tw-border-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[radial-gradient\(ellipse_at_top\2c _var\(--tw-gradient-stops\)\)\]{background-image:radial-gradient(ellipse at top,var(--tw-gradient-stops))}.from-gray-800{--tw-gradient-from:#1f2937 var(--tw-gradient-from-position);--tw-gradient-to:rgb(31 41 55 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-gray-900{--tw-gradient-to:rgb(17 24 39 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #111827 var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black{--tw-gradient-to:#000 var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pl-0{padding-left:0}.pl-0\.5{padding-left:.125rem}.pl-1{padding-left:.25rem}.pl-3{padding-left:.75rem}.pl-4{padding-left:1rem}.pr-8{padding-right:2rem}.text-center{text-align:center}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-5{line-height:1.25rem}.leading-6{line-height:1.5rem}.leading-7{line-height:1.75rem}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.blur{--tw-blur:blur(8px);filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.filter{filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}.duration-200{transition-duration:200ms}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.hover\:text-orange-500:hover{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.hover\:text-orange-600:hover{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}.hover\:text-slate-800:hover{--tw-text-opacity:1;color:rgb(30 41 59/var(--tw-text-opacity))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:block{display:block}@media(min-width:640px){.sm\:max-w-sm{max-width:24rem}.sm\:px-0{padding-left:0;padding-right:0}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:py-6{padding-top:1.5rem;padding-bottom:1.5rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.sm\:ring-gray-900\/10{--tw-ring-color:rgb(17 24 39 / 0.1)}}@media(min-width:768px){.md\:order-1{order:1}.md\:mt-0{margin-top:0}.md\:py-16{padding-top:4rem;padding-bottom:4rem}.md\:py-8{padding-top:2rem;padding-bottom:2rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:text-base{font-size:1rem;line-height:1.5rem}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media(min-width:1024px){.lg\:relative{position:relative}.lg\:top-0{top:0}.lg\:mb-0{margin-bottom:0}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:h-auto{height:auto}.lg\:w-\[50vw\]{width:50vw}.lg\:max-w-none{max-width:none}.lg\:max-w-\[1600px\]{max-width:1600px}.lg\:flex-1{flex:1}.lg\:flex-none{flex:none}.lg\:flex-row{flex-direction:row}.lg\:justify-center{justify-content:center}.lg\:bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.lg\:px-0{padding-left:0;padding-right:0}.lg\:px-8{padding-left:2rem;padding-right:2rem}.lg\:pl-8{padding-left:2rem}.lg\:pr-0{padding-right:0}.lg\:text-sm{font-size:.875rem;line-height:1.25rem}.lg\:shadow-none{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}}@media(min-width:1280px){.xl\:w-72{width:18rem}.xl\:px-12{padding-left:3rem;padding-right:3rem}.xl\:px-16{padding-left:4rem;padding-right:4rem}.xl\:pr-16{padding-right:4rem}}</style></head><body><header class="z-50"><nav class="flex items-end justify-between py-6 lg:px-8" aria-label="Global"><div class="flex lg:hidden pl-4"><button type="button" id="menuOpen" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700 hover:text-orange-500">
<span class="sr-only">Open main menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></button></div><div class="hidden lg:flex lg:flex-1 lg:justify-center"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-900 mx-12">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">About</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Articles</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Learn</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Videos</a></div></nav><div class="lg:hidden" role="dialog" aria-modal="true"><div class="fixed inset-y-0 left-0 z-50 w-full overflow-y-auto bg-white px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10 hidden" id="mobileMenu"><div class="flex items-center justify-between"><button type="button" class="-m-2.5 rounded-md p-2.5 text-gray-700" id="menuClose">
<span class="sr-only">Close menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="mt-6 flow-root"><div class="-my-6 divide-y divide-gray-500/10"><div class="space-y-2 py-6"><a href="https://im5tu.io/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Home</a>
<a href="https://im5tu.io/about/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">About</a>
<a href="https://im5tu.io/article/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Articles</a>
<a href="https://im5tu.io/learn/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Learn</a>
<a href="https://im5tu.io/video/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Videos</a></div></div></div></div></div></header><main class="isolate"><div class="bg-white px-6 py-8 lg:px-8"><article itemscope itemtype="https://schema.org/BlogPosting" class="mx-auto max-w-5xl text-base leading-7 text-gray-700"><meta itemprop="wordCount" content="2221"><meta itemprop="abstract" content="
  


This blog post is also available as a video on my YouTube Channel.
Ever wondered how to get docker images to run nicely with XUnit tests? Then you&rsquo;re in the right place. Let me show you how to setup Localstack with XUnit properly so that the only thing you need to worry about is having docker running. I&rsquo;m using Localstack as the example but you can repeat a very similar process using the techniques shown here."><nav class="flex mb-6" aria-label="Breadcrumb"><ol role="list" class="flex items-center space-x-4 list-none" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="1"><meta itemprop="url item" content="https://im5tu.io/"><div><a href="https://im5tu.io/" class="text-gray-400 hover:text-orange-500"><svg class="h-4 w-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M9.293 2.293a1 1 0 011.414.0l7 7A1 1 0 0117 11h-1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3a1 1 0 00-1-1H9a1 1 0 00-1 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-6H3a1 1 0 01-.707-1.707l7-7z" clip-rule="evenodd"/></svg><span itemprop="name" class="sr-only">CodeWithStu</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="2"><meta itemprop="url item" content="https://im5tu.io/article/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">Articles</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="3"><meta itemprop="url item" content="https://im5tu.io/article/2022/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/2022/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">2022</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="4"><meta itemprop="url item" content="https://im5tu.io/article/2022/09/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">September</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="5"><div class="flex items-center"><meta itemprop="url item" content="https://im5tu.io/article/2022/09/pro-testing-with-xunit-localstack/"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">Pro Testing with Xunit & Localstack</span></a></div></li></ol></nav><h1 itemprop="name headline" class="mt-2 mb-0 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Pro Testing with Xunit & Localstack</h1><div><div itemprop="author" itemscope itemtype="http://schema.org/Person" id="codewithstu" class="hidden"><meta itemprop="name" content="Stuart Blackler"><meta itemprop="jobTitle" content="Principal Software Engineer"><meta itemprop="description" content="I help you grow as a developer. I love to talk about #aws, #devops, #dotnet, #aspnetcore, and #opentelemetry"><meta itemprop="knowsAbout" content="AWS, DevOps, .NET, ASP.NET Core, OpenTelemetry, C#, .Net Core, Kubernetes, XUnit, Git, Github, FluentAssertions, SQL Server, Azure, Docker, Kubernetes, Apache Kafka, Elasticsearch, Redis, SAP Business One, WCF, TFSVC"><link itemprop="sameAs" href="https://twitter.com/CodeWithStu"><link itemprop="sameAs" href="https://bsky.app/profile/codewithstu.tv"><link itemprop="sameAs" href="https://github.com/im5tu"><link itemprop="sameAs" href="https://www.linkedin.com/in/codewithstu/"><link itemprop="sameAs" href="https://www.youtube.com/@CodeWithStu"><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Illuvium.io"><meta itemprop="url" content="https://illuvium.io/"><meta itemprop="description" content="Principle C# Engineer, January 2024 - Present. London, England, United Kingdom"></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Loupe"><meta itemprop="url" content="https://loupe.work"><meta itemprop="description" content="Principal Engineer, August 2022 - December 2023. London, England, United Kingdom. Guided teams, AWS infrastructure, reduced build times, updated coding standards."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Checkout.com"><meta itemprop="url" content="https://checkout.com"><meta itemprop="description" content="Principal Engineer, March 2021 - July 2022. London, England, United Kingdom. Technical direction, auditing/security architectures, AWS Organisational Accounts, observability & security packages."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="GfK"><meta itemprop="url" content="https://https://www.gfk.com/"><meta itemprop="description" content="Senior Software Engineer (Contract), October 2018 - June 2019. Slough, United Kingdom. Migrated crawling platform to AWS, performance troubleshooting, and growth strategies."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ClearBank"><meta itemprop="url" content="https://clear.bank"><meta itemprop="description" content="Lead Architect, June 2018 - October 2018. London, United Kingdom. Designed core infrastructure, Open Banking integration, technical workshops, and customer integrations."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="4Com"><meta itemprop="url" content="https://www.4com.co.uk/"><meta itemprop="description" content=".Net Developer, September 2014 - October 2016. Bournemouth, United Kingdom. Adopted high-availability solutions, re-designed legacy architectures, and mentored junior developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Codestone Group Ltd"><meta itemprop="url" content="https://www.codestone.net/"><meta itemprop="description" content="Software Engineer, August 2013 - September 2014. Poole, Dorset, United Kingdom. Implemented solutions for SMEs, introduced agile processes, and mentored developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cemoc"><meta itemprop="url" content="https://www.cemoc.co.uk/"><meta itemprop="description" content="Software Developer, October 2009 - August 2012. Wootton Bridge, Isle of Wight, United Kingdom. Worked with various sized companies, responsible for product lifecycle and client support."></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Bournemouth University"><meta itemprop="url" href="https://www.bournemouth.ac.uk/"><meta itemprop="description" content="BSc Computing, Advanced Networking and Data Mining (2012 - 2013)"></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Isle of Wight College"><meta itemprop="url" href="https://www.iwcollege.ac.uk/"><meta itemprop="description" content="HND, Computer And Software Development (2008 - 2010)"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCSD: Web Applications"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2014-05"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCP Programming C#"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2013-06"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Developer – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-developer-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Solutions Architect – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-solutions-architect-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div></div><p class="font-normal text-gray-400 text-xs md:text-base italic m-0">Posted by <a itemprop="url" href="https://im5tu.io/about">Stuart Blackler</a>
on <time itemprop="datePublished" datetime="2022-09-25 12:00:00 +0100 +0100">September 25, 2022</time>.
Last Updated on <time itemprop="dateModified" datetime="2024-01-11T21:57:56Z">January 11, 2024</time>.
Tagged:<span class="inline mx-2 font-small"><a href="https://im5tu.io/%20tags/dotnet/" title="dotnet" class="hover:text-orange-500">dotnet</a></span><span class="inline mx-2 font-small"><a href="https://im5tu.io/%20tags/aspnetcore/" title="aspnetcore" class="hover:text-orange-500">aspnetcore</a></span></p></div><nav class="mb-2 bg-slate-50 p-6 w-fit rounded-lg"><h4 class="mt-0">Table of Contents</h4><ul class="space-y-1 pl-1 list-disc"><li><a class="hover:text-orange-600" href="#our-test-case">Our Test Case</a></li><li><a class="hover:text-orange-600" href="#xunit-features">Xunit Features</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#iasynclifetime">IAsyncLifetime</a></li><li><a class="hover:text-orange-600" href="#collection-fixtures">Collection Fixtures</a></li></ul><li><a class="hover:text-orange-600" href="#localstack-container-instance-with-testcontainers">Localstack Container Instance with TestContainers</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#setup">Setup</a></li><li><a class="hover:text-orange-600" href="#seeding-data-in-localstack">Seeding data in Localstack</a></li><li><a class="hover:text-orange-600" href="#health-check-wait-strategy">Health check wait strategy</a></li></ul></ul></nav><section itemprop="articleBody"><div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden"><iframe src="https://www.youtube-nocookie.com/embed/Ad7wruPBp3M" style="position:absolute;top:0;left:0;width:100%;height:100%;border:0" allowfullscreen title="YouTube Video"></iframe></div><p><em>This blog post is also available as a video on my <a href="https://codewithstu.tv">YouTube Channel</a>.</em></p><p>Ever wondered how to get docker images to run nicely with XUnit tests? Then you&rsquo;re in the right place. Let me show you how to setup <a href="https://localstack.cloud">Localstack</a> with XUnit properly so that the only thing you need to worry about is having docker running. I&rsquo;m using Localstack as the example but you can repeat a very similar process using the techniques shown here.</p><p>We will first setup the base infrastructure using two lesser known XUnit features before doing container management using <a href="https://github.com/testcontainers/testcontainers-dotnet">TestContainers</a>.</p><h2 id="our-test-case">Our Test Case</h2><p>To verify that we have everything working as we expect later on, I have the following test case which will require that a table be created with a specific name. If we do everything correctly, then this test should pass.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">using</span> Amazon.DynamoDBv2;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomTests</span>
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _localstackServiceUrl;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> CustomTests()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _localstackServiceUrl = <span style="color:#e6db74">&#34;http://localhost:4566&#34;</span>;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">    [Fact(Timeout = 30000)]</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task UsingLocalstack_ViaTestContainers()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// Arrange</span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> client = <span style="color:#66d9ef">new</span> AmazonDynamoDBClient(<span style="color:#66d9ef">new</span> AmazonDynamoDBConfig
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            ServiceURL = _localstackServiceUrl
</span></span><span style="display:flex"><span>        });
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// Act</span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> tables = <span style="color:#66d9ef">await</span> client.ListTablesAsync();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// Assert</span>
</span></span><span style="display:flex"><span>        Assert.True(tables.TableNames.Count == <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">$&#34;Incorrect table count found. Expected 1, found: {tables.TableNames.Count}&#34;</span>);
</span></span><span style="display:flex"><span>        Assert.True(tables.TableNames[<span style="color:#ae81ff">0</span>] == <span style="color:#e6db74">&#34;localstack-test&#34;</span>, <span style="color:#e6db74">$&#34;Table name mismatch. Expected &#39;localstack-test&#39; found: {tables.TableNames[0]}&#34;</span>);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><h2 id="xunit-features">Xunit Features</h2><h3 id="iasynclifetime">IAsyncLifetime</h3><p>The first feature that of XUnit that we are going to take a look at is lifecycle management with <code>IAsyncLifetime</code>. We’re going to use this to create an instance of a Localstack container later on, but we need to setup a class initially to use it with our second XUnitFeature. When we add this interface to a class, we tell XUnit that it needs to start and dispose of this implementation in an asynchronous manner. This means that we need to implement two methods:</p><ul><li><code>InitializeAsync</code></li><li><code>DisposeAsync</code></li></ul><p>So lets create a class called <code>LocalstackContainer</code> and stub out the methods for us to complete later on:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">using</span> DotNet.Testcontainers.Builders;
</span></span><span style="display:flex"><span><span style="color:#66d9ef">using</span> DotNet.Testcontainers.Configurations;
</span></span><span style="display:flex"><span><span style="color:#66d9ef">using</span> DotNet.Testcontainers.Containers;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LocalstackContainer</span> : IAsyncLifetime
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task InitializeAsync()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// Implement later</span>
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task DisposeAsync()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// Implement later</span>
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> ToAbsolute(<span style="color:#66d9ef">string</span> path) =&gt; Path.GetFullPath(path);
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><h3 id="collection-fixtures">Collection Fixtures</h3><p>The next feature of XUnit we are going to rely on is Collection Fixtures. This allows us to have a singleton instance of an object for all tests unlike a <code>ClassFixture</code> which only allows us to have a singleton instance for test that inherit from the class fixture. The reason I am opt-ing for a collection fixture is so that we reduce the number instances of the localstack container because it can be quite heavy to run. If you think you can get away with a regular class fixture for your project you can definitely do that.</p><p>A collection fixture needs three parts:</p><ul><li>A class for the collection definition</li><li>Adding an attribute to the test class pointing to the collection definition</li><li>Injecting the class instance into the test class</li></ul><p>Let’s take a look at the collection definition first. XUnit needs this for discovery purposes and requires us to do two things to our class:</p><ul><li>Inherit from <code>ICollectionFixture&lt;T></code> - where <code>T</code> is the type you want a singleton of, in our case we want <code>Localstackcontainer</code> which is the type we created earlier</li><li>Next we need to add a class level attribute <code>CollectionDefinition</code> which requires us to supply a name. For simplicity i’m going to use the <code>nameof</code> expression to point back to our <code>T</code>:</li></ul><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[CollectionDefinition(nameof(LocalstackContainer))]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LocalstackContainerInstanceCollectionFixture</span> : ICollectionFixture&lt;LocalstackContainer&gt;
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>And that’s for the collection definition. If we move across to our test class now, where I have already pre-populated this with a random test that will ensure that everything is working later on.</p><p>To make use of the collection definition we need to add a class level attribute called <code>Collection</code> and pass in the same name that we gave to the <code>CollectionDefinition</code> attribute on the previous class. So here we will use the same <code>nameof</code> expression so that everything lines up nicely for us.</p><p>The last bit is to create a new constructor in our test class and add a parameter for our new type - which for us is going to be our localstack container.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[Collection(nameof(LocalstackContainer))]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomTests</span>
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _localstackServiceUrl;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> CustomTests(LocalstackContainer containerInstance)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _localstackServiceUrl = <span style="color:#e6db74">&#34;http://localhost:4566&#34;</span>;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// omitted for brevity</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>So at this point, we have a XUnit all configured to use a single instance of a container class that has an asynchronous lifetime managed for us. Let’s start spinning up a docker container…</p><h2 id="localstack-container-instance-with-testcontainers">Localstack Container Instance with TestContainers</h2><h3 id="setup">Setup</h3><p>If you haven’t heard of test containers before, you really need to go and check the project out. We are going to use TestContainers to spin up a new instance of localstack in our tests using the localstack container class that we created earlier. First up, lets create two properties, one for the localstack port that we’re going to use and the next for a generated URL using the new port number just to make our lives a bit easier later on.</p><p>We then need to create a private field to hold the container so we can implement the lifecycle events later on:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LocalstackContainer</span> : IAsyncLifetime
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> TestcontainersContainer _localstackContainer;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> LocalstackPort { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> LocalstackUri =&gt; <span style="color:#e6db74">$&#34;http://localhost:{LocalstackPort}&#34;</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// omitted for brevity</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>In the constructor is where we are going to create the container definition. We create a new instance of <code>TestcontainersBuilder</code> with the type <code>TestcontainersContainer</code> from which we can configure this container. We need to call a few methods on this instance:</p><ul><li>WithImage - tells us which docker image to use</li><li>WithCleanUp - tells TestContainers to clean up the image when we are done with it</li><li>WithPortBinding - maps the ports for us. It’s important that we use the generated port number here mapping back to the localstack port of 4566.</li><li>WithWaitStrategy - is used to tell us to wait for the port to become available. We’ll come back to this later.</li></ul><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> LocalstackContainer()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// Randomise the port to prevent port errors</span>
</span></span><span style="display:flex"><span>    LocalstackPort = Random.Shared.Next(<span style="color:#ae81ff">4000</span>, <span style="color:#ae81ff">5000</span>);
</span></span><span style="display:flex"><span>    _localstackContainer = <span style="color:#66d9ef">new</span> TestcontainersBuilder&lt;TestcontainersContainer&gt;()
</span></span><span style="display:flex"><span>        .WithImage(<span style="color:#e6db74">&#34;localstack/localstack&#34;</span>)
</span></span><span style="display:flex"><span>        .WithCleanUp(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>        .WithPortBinding(LocalstackPort, <span style="color:#ae81ff">4566</span>)
</span></span><span style="display:flex"><span>        .Build();
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Once that’s all done, we can then build the container definition. Next we need to go and configure the lifecycle events to start and stop our container:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task InitializeAsync()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">using</span> var cts = <span style="color:#66d9ef">new</span> CancellationTokenSource(TimeSpan.FromMinutes(<span style="color:#ae81ff">5</span>));
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">await</span> _localstackContainer.StartAsync(cts.Token);
</span></span><span style="display:flex"><span>}
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task DisposeAsync()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">await</span> _localstackContainer.DisposeAsync();
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>In the <code>InitializeAsync</code> method, we first need to create a new <code>CancellationTokenSource</code> so that we can abort any slow start ups if we need to. Then we call <code>StartAsync</code> on the container instance we setup earlier, remembering to pass in the cancellation token.</p><p>In the <code>DisposeAsync</code> method, we just need to call <code>DisposeAsync</code> on the TestContainers instance.</p><p>Before we can test this, we need to ensure that we update our tests to look at the new localstack URL:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[Collection(nameof(LocalstackContainer))]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomTests</span>
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _localstackServiceUrl;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> CustomTests(LocalstackContainer containerInstance)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _localstackServiceUrl = containerInstance.LocalstackUri;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// omitted for brevity</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>With this now done, we are in a suitable point where we can test the entire flow and watch our docker container spin up and teardown without any effort other than clicking run on the tests. The test will still fail at this point, but the lifecycle of our docker image is now managed.</p><h3 id="seeding-data-in-localstack">Seeding data in Localstack</h3><p>Now that we have a container up and running, we want the ability to to seed it with something useful, such as data for a dynamodb table. In order to do this, we need to change our container configuration a bit.</p><p>We are going to create two directories for our data:</p><ul><li>aws-seed-data: which will hold our initialization script and our next directory:</li><li>scripts: this is where the bulk of your scripts will go</li></ul><p>Under the <code>aws-seed-data</code> directory, create a new file called <code>init.sh</code> ensuring that the line endings are set to <code>LF</code> only. This file will help us control the ordering and invocation of sub-scripts later on.</p><p>Next under the scripts sub-directory, create a new script called <code>dynamodb.sh</code>. In here we are going to create a new dynamo db table using the <code>awslocal</code> command. This command is essentially a fully fledged AWS CLI but you never have to set the endpoint, which makes it super handy for scripting. In my example here, I’m just creating a dynamo table as I would normally, just switch <code>aws</code> for <code>awslocal</code>. Although I’m not doing it here, you can do a lot of fancy things like pre-seeding the dynamo table with a set amount of data for example.</p><p><img src="folder-structure.png" alt="Desired Folder Structure"></p><p>Inside of our init script, we need to have the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#75715e">#!/bin/sh
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex"><span>/scripts/dynamodb.sh
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>exit <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>Note that the forward slash at the start is very important as your just about to see.</p><p>Inside of our <code>dynamodb.sh</code> script, we need to have the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#75715e">#!/bin/sh
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex"><span>awslocal dynamodb create-table <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>          --table-name localstack-test <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>          --key-schema AttributeName<span style="color:#f92672">=</span>PartitionKey,KeyType<span style="color:#f92672">=</span>HASH AttributeName<span style="color:#f92672">=</span>SortKey,KeyType<span style="color:#f92672">=</span>RANGE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>          --attribute-definitions AttributeName<span style="color:#f92672">=</span>PartitionKey,AttributeType<span style="color:#f92672">=</span>S AttributeName<span style="color:#f92672">=</span>SortKey,AttributeType<span style="color:#f92672">=</span>S <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>          --provisioned-throughput ReadCapacityUnits<span style="color:#f92672">=</span>10,WriteCapacityUnits<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p>If we now head back to our localstack container instance, we need to adjust the setup to mount our new seeding files. To do this we need the full path on the host that we want to mount and its corresponding destination in the docker image.</p><p>Localstack has a special folder in the image which is used to look for scripts at different parts of the initialization process - called <code>/etc/localstack/init</code> - this folder contains 4 directories:</p><ul><li><code>boot.d</code>: Scripts that run whenthe container is running but the LocalStack runtime has not been started</li><li><code>start.d</code>: Scripts that run when the Python process is running and the LocalStack runtime is starting</li><li><code>ready.d</code>: Scripts that run when LocalStack is ready to serve requests</li><li><code>shutdown.d</code>: Scripts that run when LocalStack is shutting down</li></ul><p>We are going to mount the folder containing our <code>init.sh</code> script to the <code>ready.d</code> directory - so once localstack is ready it will execute that script. To do this, we call <code>WithBindMount</code> on the container image, passing in our folder followed by the folder in the docker image:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> LocalstackContainer()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    LocalstackPort = Random.Shared.Next(<span style="color:#ae81ff">4000</span>, <span style="color:#ae81ff">5000</span>);
</span></span><span style="display:flex"><span>    _localstackContainer = <span style="color:#66d9ef">new</span> TestcontainersBuilder&lt;TestcontainersContainer&gt;()
</span></span><span style="display:flex"><span>        .WithImage(<span style="color:#e6db74">&#34;localstack/localstack&#34;</span>)
</span></span><span style="display:flex"><span>        .WithCleanUp(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>        .WithPortBinding(LocalstackPort, <span style="color:#ae81ff">4566</span>)
</span></span><span style="display:flex"><span>        .WithBindMount(ToAbsolute(<span style="color:#e6db74">&#34;./localstack/aws-seed-data&#34;</span>), <span style="color:#e6db74">&#34;/etc/localstack/init/ready.d&#34;</span>, AccessMode.ReadOnly)
</span></span><span style="display:flex"><span>        .WithBindMount(ToAbsolute(<span style="color:#e6db74">&#34;./localstack/aws-seed-data/scripts&#34;</span>), <span style="color:#e6db74">&#34;/scripts&#34;</span>, AccessMode.ReadOnly)
</span></span><span style="display:flex"><span>        .Build();
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>We also need to map our scripts directory, so again we need to call <code>WithBindMount</code> and map the scripts directory to <code>/scripts</code></p><h3 id="health-check-wait-strategy">Health check wait strategy</h3><p>With our container now seeded, we have a slight ordering problem. Our tests may execute before our localstack instance has been fully provisioned. Luckily for us, both TestContainers and Localstack has us covered here.</p><p>Localstack has an endpoint that we can call to check the status of the initialization. This is located on the endpoint <code>_localstack/init/ready</code>.</p><p>TestContainers allows us to provide our own wait strategy too - so we can use that to create a new wait check by implementing the <code>IWaitUntil</code> class.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LocalstackContainerHealthCheck</span> : IWaitUntil
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#66d9ef">string</span> _endpoint;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> LocalstackContainerHealthCheck(<span style="color:#66d9ef">string</span> endpoint)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _endpoint = endpoint;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>In the constructor of the wait check, we need to take a single parameter which is going to be the endpoint that localstack will be listening on. In the <code>Until</code> method we need to make a quick call to the API. The structure of the json returned has a <code>completed</code> object that has keys for each of the initialization phases. It also has a scripts section which contains a list of scripts for each stage and their corresponding states. We just need to look for the <code>init.sh</code> script in <code>READY</code> stage and ensure that it has the state <code>SUCCESSFUL</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;<span style="color:#66d9ef">bool</span>&gt; Until(ITestcontainersContainer testcontainers, ILogger logger)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// https://github.com/localstack/localstack/pull/6716</span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">using</span> var httpClient = <span style="color:#66d9ef">new</span> HttpClient { BaseAddress = <span style="color:#66d9ef">new</span> Uri(_endpoint) };
</span></span><span style="display:flex"><span>        JsonNode? result;
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            result = <span style="color:#66d9ef">await</span> httpClient.GetFromJsonAsync&lt;JsonNode&gt;(<span style="color:#e6db74">&#34;/_localstack/init/ready&#34;</span>);
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">catch</span>
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (result <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> scripts = result[<span style="color:#e6db74">&#34;scripts&#34;</span>];
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (scripts <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> script <span style="color:#66d9ef">in</span> scripts.Deserialize&lt;IEnumerable&lt;Script&gt;&gt;() ?? Enumerable.Empty&lt;Script&gt;())
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (!<span style="color:#e6db74">&#34;READY&#34;</span>.Equals(script.Stage, StringComparison.OrdinalIgnoreCase))
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (!<span style="color:#e6db74">&#34;init.sh&#34;</span>.Equals(script.Name, StringComparison.OrdinalIgnoreCase))
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;SUCCESSFUL&#34;</span>.Equals(script.State, StringComparison.OrdinalIgnoreCase);
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">record</span> <span style="color:#a6e22e">Script</span>(
</span></span><span style="display:flex"><span><span style="color:#a6e22e">        [property: JsonPropertyName(&#34;stage&#34;)]</span> <span style="color:#66d9ef">string</span> Stage,
</span></span><span style="display:flex"><span><span style="color:#a6e22e">        [property: JsonPropertyName(&#34;state&#34;)]</span> <span style="color:#66d9ef">string</span> State,
</span></span><span style="display:flex"><span><span style="color:#a6e22e">        [property: JsonPropertyName(&#34;name&#34;)]</span> <span style="color:#66d9ef">string</span> Name
</span></span><span style="display:flex"><span>        );
</span></span></code></pre></div><p>The last bit for us to do is to configure the wait strategy for the container. In the container definition, we need to call a method called <code>WithWaitStrategy</code>. This takes one or more wait strategies which are built using the <code>Wait</code> class. The first thing we need to do here is tell Testcontainers that we are going to be waiting for a linux container by calling <code>Wait.ForUnixContainer</code> - then we can add two additional methods:</p><ul><li><code>UntilPortIsAvailable</code> - which will check the linux container to ensure that a port is being listened on. This will always need to be the container port, so in our case localstack’s port of 4566, not the randomised port we created earlier.</li><li><code>AddCustomWaitStrategy</code> - which we need to pass in a new instance of our new wait strategy</li></ul><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> LocalstackContainer()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    LocalstackPort = Random.Shared.Next(<span style="color:#ae81ff">4000</span>, <span style="color:#ae81ff">5000</span>);
</span></span><span style="display:flex"><span>    _localstackContainer = <span style="color:#66d9ef">new</span> TestcontainersBuilder&lt;TestcontainersContainer&gt;()
</span></span><span style="display:flex"><span>        .WithImage(<span style="color:#e6db74">&#34;localstack/localstack&#34;</span>)
</span></span><span style="display:flex"><span>        .WithCleanUp(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>        .WithPortBinding(LocalstackPort, <span style="color:#ae81ff">4566</span>)
</span></span><span style="display:flex"><span>        .WithWaitStrategy(Wait.ForUnixContainer()
</span></span><span style="display:flex"><span>            .UntilPortIsAvailable(<span style="color:#ae81ff">4566</span>)
</span></span><span style="display:flex"><span>            .AddCustomWaitStrategy(<span style="color:#66d9ef">new</span> LocalstackContainerHealthCheck(LocalstackUri))
</span></span><span style="display:flex"><span>        )
</span></span><span style="display:flex"><span>        .WithBindMount(ToAbsolute(<span style="color:#e6db74">&#34;./localstack/aws-seed-data&#34;</span>), <span style="color:#e6db74">&#34;/etc/localstack/init/ready.d&#34;</span>, AccessMode.ReadOnly)
</span></span><span style="display:flex"><span>        .WithBindMount(ToAbsolute(<span style="color:#e6db74">&#34;./localstack/aws-seed-data/scripts&#34;</span>), <span style="color:#e6db74">&#34;/scripts&#34;</span>, AccessMode.ReadOnly)
</span></span><span style="display:flex"><span>        .Build();
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>With all of these steps completed, you should now have tests that are nice and repeatable using XUnit and Localstack! If you’re wondering what else you’re missing out on, check out some of the <a href="https://www.youtube.com/watch?v=6USQ3_81wQM">latest features in .NET 7 you may have missed</a>.</p><p><em>The full code for this is available to my <a href="https://github.com/sponsors/im5tu">Github Sponsors</a>.</em></p></section><div class="mt-4 border-t border-slate-400"><p><a href="https://im5tu.io/about/" title="About Stuart Blackler">Stuart Blackler</a> is a seasoned technologist with over 15 years of commercial experience in the .NET ecosystem.
Holding a degree in Computer Science, Stuart has earned
certifications as a C# developer through Microsoft and as an AWS Solutions Architect and Developer. Stuart is
the creator of the popular YouTube channel <a href="https://youtube.com/@codewithstu">CodeWithStu</a>, where he delves into topics close to his heart, including .NET, AWS, DevOps,
and software architecture with a commitment to sharing knowledge and fostering a community of learners.</p></div></article></div></main><footer class="border-t border-gray-900/10 py-12 sm:py-6 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-gray-800 via-gray-900 to-black"><div><div class="hidden lg:flex lg:flex-1 justify-center mb-12"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">About</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Articles</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Learn</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Videos</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a></div><div class="flex justify-center space-x-12 my-6"><a href="https://www.youtube.com/@CodeWithStu?sub_confirmation=1" class="text-gray-400 hover:text-orange-500" target="_blank" title="Subscribe To Me On YouTube"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></svg></a><a href="https://www.linkedin.com/in/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Connect With Me LinkedIn"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.98 3.5C4.98 4.881 3.87 6 2.5 6s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zM5 8H0v16h5V8zm7.982.0H8.014v16h4.969v-8.399c0-4.67 6.029-5.052 6.029.0V24H24V13.869c0-7.88-8.922-7.593-11.018-3.714V8z"/></svg></a><a href="https://github.com/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Follow Me On GitHub"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-xs leading-5 text-gray-500">&copy; 2023 <a href="https://im5tu.io/" class="hover:text-orange-500">im5tu.io</a> - All rights reserved.</p></div></div></footer><script>document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("menuOpen"),t=document.getElementById("menuClose"),n=document.getElementById("mobileMenu");t&&e&&(t.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}),e.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}))})</script></body></html>
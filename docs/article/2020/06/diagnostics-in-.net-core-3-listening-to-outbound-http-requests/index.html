<!doctype html><html lang="en"><head><title>Diagnostics in .Net Core 3: Listening to outbound HTTP requests | June | 2020 | Articles | CodeWithStu's Blog</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="A look into the EventCounters API in .Net Core 3, and seeing how we can capture outbound HTTP Requests."><meta name="keywords" content><link rel="icon" type="image/x-icon" href="https://im5tu.io/assets/favicon.ico"><link rel="canonical" href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-outbound-http-requests/"><meta property="og:url" content="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-outbound-http-requests/"><meta property="og:type" content="website"><meta property="og:title" content="Diagnostics in .Net Core 3: Listening to outbound HTTP requests | June | 2020 | Articles | CodeWithStu's Blog"><meta property="og:description" content="A look into the EventCounters API in .Net Core 3, and seeing how we can capture outbound HTTP Requests."><meta property="og:image" content="/assets/profile.jpg"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:domain" content="im5tu.io"><meta property="twitter:url" content="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-outbound-http-requests/"><meta name="twitter:title" content="Diagnostics in .Net Core 3: Listening to outbound HTTP requests | June | 2020 | Articles | CodeWithStu's Blog"><meta name="twitter:description" content="A look into the EventCounters API in .Net Core 3, and seeing how we can capture outbound HTTP Requests."><meta name="twitter:image" content="/assets/profile.jpg"><script defer data-domain="im5tu.io" src="https://plausible.io/js/script.js"></script><style type="text/css">*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::before,::after{--tw-content:''}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,liberation mono,courier new,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}table{width:100%;table-layout:auto;border-collapse:collapse;text-align:left;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}table:where([dir=rtl],[dir=rtl] *){text-align:right}@media(prefers-color-scheme:dark){table{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table th{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity));font-size:.75rem;line-height:1rem;text-transform:uppercase;--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table th{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity));--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table tbody tr{border-bottom-width:1px;--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity));vertical-align:top}@media(prefers-color-scheme:dark){table tbody tr{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity));--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}table td,table th{padding-left:1.5rem;padding-right:1.5rem;padding-top:1rem;padding-bottom:1rem;vertical-align:top}table tbody tr:first-child-of-type(td){white-space:nowrap;font-weight:500;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table tbody tr:first-child-of-type(td){--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}}h1,h2,h3,h4,h5,h6{line-height:1;letter-spacing:-.025em;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}h1,h2,h3{font-weight:800}h1{margin-top:2rem;margin-bottom:2rem;font-size:2.25rem;line-height:2.5rem}@media(min-width:768px){h1{font-size:3rem;line-height:1}}@media(min-width:1024px){h1{font-size:3.75rem;line-height:1}}h2{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1.875rem;line-height:2.25rem}h3{margin-top:1rem;margin-bottom:1rem;font-size:1.5rem;line-height:2rem}h4,h5,h6{margin-top:.75rem;margin-bottom:.75rem;font-weight:700}h4{font-size:1.25rem;line-height:1.75rem}p{padding-top:1rem;padding-bottom:1rem;font-size:1rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity))}p code,li code{font-weight:700;--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}p a:link,p a:visited{font-style:italic;--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}p a:link:hover,p a:visited:hover{--tw-text-opacity:1;color:rgb(154 52 18/var(--tw-text-opacity))}pre>code{display:block;overflow:auto;padding:1.5rem;font-weight:400}ul{list-style-position:inside;list-style-type:disc}ul>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}section ul ul,section ul ol,section ol ul{margin-left:1rem}ol{list-style-position:inside;list-style-type:decimal}ol>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}*,::before,::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.\!relative{position:relative!important}.relative{position:relative}.sticky{position:sticky}.inset-y-0{top:0;bottom:0}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-\[3\.5rem\]{top:3.5rem}.top-\[4\.5rem\]{top:4.5rem}.isolate{isolation:isolate}.z-50{z-index:50}.-m-2{margin:-.5rem}.-m-2\.5{margin:-.625rem}.m-0{margin:0}.-mx-3{margin-left:-.75rem;margin-right:-.75rem}.-my-6{margin-top:-1.5rem;margin-bottom:-1.5rem}.mx-12{margin-left:3rem;margin-right:3rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-3{margin-top:.75rem;margin-bottom:.75rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mb-0{margin-bottom:0}.mb-1{margin-bottom:.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-4{margin-left:1rem}.mt-0{margin-top:0}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.flow-root{display:flow-root}.contents{display:contents}.hidden{display:none}.h-0{height:0}.h-0\.5{height:.125rem}.h-12{height:3rem}.h-4{height:1rem}.h-48{height:12rem}.h-6{height:1.5rem}.h-screen{height:100vh}.w-12{width:3rem}.w-28{width:7rem}.w-4{width:1rem}.w-48{width:12rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.min-w-0{min-width:0}.min-w-\[25\%\]{min-width:25%}.min-w-\[7rem\]{min-width:7rem}.max-w-5xl{max-width:64rem}.max-w-\[1600px\]{max-width:1600px}.max-w-\[30\%\]{max-width:30%}.max-w-screen-xl{max-width:1280px}.max-w-2xl{max-width:42rem}.flex-auto{flex:auto}.flex-shrink-0{flex-shrink:0}.grow{flex-grow:1}.grow-0{flex-grow:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.list-disc{list-style-type:disc}.list-none{list-style-type:none}.flex-col{flex-direction:column}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.space-x-12>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(3rem * var(--tw-space-x-reverse));margin-left:calc(3rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-24>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(6rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(6rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.divide-gray-500\/10>:not([hidden])~:not([hidden]){border-color:rgb(107 114 128/.1)}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-900\/10{border-color:rgb(17 24 39/.1)}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225/var(--tw-border-opacity))}.border-slate-400{--tw-border-opacity:1;border-color:rgb(148 163 184/var(--tw-border-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[radial-gradient\(ellipse_at_top\2c _var\(--tw-gradient-stops\)\)\]{background-image:radial-gradient(ellipse at top,var(--tw-gradient-stops))}.from-gray-800{--tw-gradient-from:#1f2937 var(--tw-gradient-from-position);--tw-gradient-to:rgb(31 41 55 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-gray-900{--tw-gradient-to:rgb(17 24 39 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #111827 var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black{--tw-gradient-to:#000 var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pl-0{padding-left:0}.pl-0\.5{padding-left:.125rem}.pl-1{padding-left:.25rem}.pl-3{padding-left:.75rem}.pl-4{padding-left:1rem}.pr-8{padding-right:2rem}.text-center{text-align:center}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-5{line-height:1.25rem}.leading-6{line-height:1.5rem}.leading-7{line-height:1.75rem}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.blur{--tw-blur:blur(8px);filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.filter{filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}.duration-200{transition-duration:200ms}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.hover\:text-orange-500:hover{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.hover\:text-orange-600:hover{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}.hover\:text-slate-800:hover{--tw-text-opacity:1;color:rgb(30 41 59/var(--tw-text-opacity))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:block{display:block}@media(min-width:640px){.sm\:max-w-sm{max-width:24rem}.sm\:px-0{padding-left:0;padding-right:0}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:py-6{padding-top:1.5rem;padding-bottom:1.5rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.sm\:ring-gray-900\/10{--tw-ring-color:rgb(17 24 39 / 0.1)}}@media(min-width:768px){.md\:order-1{order:1}.md\:mt-0{margin-top:0}.md\:py-16{padding-top:4rem;padding-bottom:4rem}.md\:py-8{padding-top:2rem;padding-bottom:2rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:text-base{font-size:1rem;line-height:1.5rem}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media(min-width:1024px){.lg\:relative{position:relative}.lg\:top-0{top:0}.lg\:mb-0{margin-bottom:0}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:h-auto{height:auto}.lg\:w-\[50vw\]{width:50vw}.lg\:max-w-none{max-width:none}.lg\:max-w-\[1600px\]{max-width:1600px}.lg\:flex-1{flex:1}.lg\:flex-none{flex:none}.lg\:flex-row{flex-direction:row}.lg\:justify-center{justify-content:center}.lg\:bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.lg\:px-0{padding-left:0;padding-right:0}.lg\:px-8{padding-left:2rem;padding-right:2rem}.lg\:pl-8{padding-left:2rem}.lg\:pr-0{padding-right:0}.lg\:text-sm{font-size:.875rem;line-height:1.25rem}.lg\:shadow-none{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}}@media(min-width:1280px){.xl\:w-72{width:18rem}.xl\:px-12{padding-left:3rem;padding-right:3rem}.xl\:px-16{padding-left:4rem;padding-right:4rem}.xl\:pr-16{padding-right:4rem}}</style></head><body><header class="z-50"><nav class="flex items-end justify-between py-6 lg:px-8" aria-label="Global"><div class="flex lg:hidden pl-4"><button type="button" id="menuOpen" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700 hover:text-orange-500">
<span class="sr-only">Open main menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></button></div><div class="hidden lg:flex lg:flex-1 lg:justify-center"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-900 mx-12">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">About</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Articles</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Learn</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Videos</a></div></nav><div class="lg:hidden" role="dialog" aria-modal="true"><div class="fixed inset-y-0 left-0 z-50 w-full overflow-y-auto bg-white px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10 hidden" id="mobileMenu"><div class="flex items-center justify-between"><button type="button" class="-m-2.5 rounded-md p-2.5 text-gray-700" id="menuClose">
<span class="sr-only">Close menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="mt-6 flow-root"><div class="-my-6 divide-y divide-gray-500/10"><div class="space-y-2 py-6"><a href="https://im5tu.io/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Home</a>
<a href="https://im5tu.io/about/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">About</a>
<a href="https://im5tu.io/article/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Articles</a>
<a href="https://im5tu.io/learn/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Learn</a>
<a href="https://im5tu.io/video/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Videos</a></div></div></div></div></div></header><main class="isolate"><div class="bg-white px-6 py-8 lg:px-8"><article itemscope itemtype="https://schema.org/BlogPosting" class="mx-auto max-w-5xl text-base leading-7 text-gray-700"><meta itemprop="wordCount" content="2567"><meta itemprop="abstract" content="Throughout the course of my Diagnostics in .Net Core series, we&rsquo;ve taken a look at the basics of how to use the Event Counters API. In this article, we will take a look at how we can capture all outbound HTTP requests automatically as they occur."><nav class="flex mb-6" aria-label="Breadcrumb"><ol role="list" class="flex items-center space-x-4 list-none" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="1"><meta itemprop="url item" content="https://im5tu.io/"><div><a href="https://im5tu.io/" class="text-gray-400 hover:text-orange-500"><svg class="h-4 w-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M9.293 2.293a1 1 0 011.414.0l7 7A1 1 0 0117 11h-1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3a1 1 0 00-1-1H9a1 1 0 00-1 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-6H3a1 1 0 01-.707-1.707l7-7z" clip-rule="evenodd"/></svg><span itemprop="name" class="sr-only">CodeWithStu</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="2"><meta itemprop="url item" content="https://im5tu.io/article/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">Articles</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="3"><meta itemprop="url item" content="https://im5tu.io/article/2020/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/2020/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">2020</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="4"><meta itemprop="url item" content="https://im5tu.io/article/2020/06/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">June</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="5"><div class="flex items-center"><meta itemprop="url item" content="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-outbound-http-requests/"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">Diagnostics in .Net Core 3: Listening to outbound HTTP requests</span></a></div></li></ol></nav><h1 itemprop="name headline" class="mt-2 mb-0 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Diagnostics in .Net Core 3: Listening to outbound HTTP requests</h1><div><div itemprop="author" itemscope itemtype="http://schema.org/Person" id="codewithstu" class="hidden"><meta itemprop="name" content="Stuart Blackler"><meta itemprop="jobTitle" content="Principal Software Engineer"><meta itemprop="description" content="I help you grow as a developer. I love to talk about #aws, #devops, #dotnet, #aspnetcore, and #opentelemetry"><meta itemprop="knowsAbout" content="AWS, DevOps, .NET, ASP.NET Core, OpenTelemetry, C#, .Net Core, Kubernetes, XUnit, Git, Github, FluentAssertions, SQL Server, Azure, Docker, Kubernetes, Apache Kafka, Elasticsearch, Redis, SAP Business One, WCF, TFSVC"><link itemprop="sameAs" href="https://twitter.com/CodeWithStu"><link itemprop="sameAs" href="https://bsky.app/profile/codewithstu.tv"><link itemprop="sameAs" href="https://github.com/im5tu"><link itemprop="sameAs" href="https://www.linkedin.com/in/codewithstu/"><link itemprop="sameAs" href="https://www.youtube.com/@CodeWithStu"><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Illuvium.io"><meta itemprop="url" content="https://illuvium.io/"><meta itemprop="description" content="Principle C# Engineer, January 2024 - Present. London, England, United Kingdom"></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Loupe"><meta itemprop="url" content="https://loupe.work"><meta itemprop="description" content="Principal Engineer, August 2022 - December 2023. London, England, United Kingdom. Guided teams, AWS infrastructure, reduced build times, updated coding standards."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Checkout.com"><meta itemprop="url" content="https://checkout.com"><meta itemprop="description" content="Principal Engineer, March 2021 - July 2022. London, England, United Kingdom. Technical direction, auditing/security architectures, AWS Organisational Accounts, observability & security packages."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="GfK"><meta itemprop="url" content="https://https://www.gfk.com/"><meta itemprop="description" content="Senior Software Engineer (Contract), October 2018 - June 2019. Slough, United Kingdom. Migrated crawling platform to AWS, performance troubleshooting, and growth strategies."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ClearBank"><meta itemprop="url" content="https://clear.bank"><meta itemprop="description" content="Lead Architect, June 2018 - October 2018. London, United Kingdom. Designed core infrastructure, Open Banking integration, technical workshops, and customer integrations."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="4Com"><meta itemprop="url" content="https://www.4com.co.uk/"><meta itemprop="description" content=".Net Developer, September 2014 - October 2016. Bournemouth, United Kingdom. Adopted high-availability solutions, re-designed legacy architectures, and mentored junior developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Codestone Group Ltd"><meta itemprop="url" content="https://www.codestone.net/"><meta itemprop="description" content="Software Engineer, August 2013 - September 2014. Poole, Dorset, United Kingdom. Implemented solutions for SMEs, introduced agile processes, and mentored developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cemoc"><meta itemprop="url" content="https://www.cemoc.co.uk/"><meta itemprop="description" content="Software Developer, October 2009 - August 2012. Wootton Bridge, Isle of Wight, United Kingdom. Worked with various sized companies, responsible for product lifecycle and client support."></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Bournemouth University"><meta itemprop="url" href="https://www.bournemouth.ac.uk/"><meta itemprop="description" content="BSc Computing, Advanced Networking and Data Mining (2012 - 2013)"></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Isle of Wight College"><meta itemprop="url" href="https://www.iwcollege.ac.uk/"><meta itemprop="description" content="HND, Computer And Software Development (2008 - 2010)"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCSD: Web Applications"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2014-05"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCP Programming C#"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2013-06"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Developer – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-developer-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Solutions Architect – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-solutions-architect-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div></div><p class="font-normal text-gray-400 text-xs md:text-base italic m-0">Posted by <a itemprop="url" href="https://im5tu.io/about">Stuart Blackler</a>
on <time itemprop="datePublished" datetime="2020-06-18 01:34:00 +0000 UTC">June 18, 2020</time>.
Last Updated on <time itemprop="dateModified" datetime="2024-01-11T21:57:56Z">January 11, 2024</time>.
Tagged:<span class="inline mx-2 font-small"><a href="https://im5tu.io/%20tags/dotnet/" title="dotnet" class="hover:text-orange-500">dotnet</a></span></p></div><nav class="mb-2 bg-slate-50 p-6 w-fit rounded-lg"><h4 class="mt-0">Table of Contents</h4><ul class="space-y-1 pl-1 list-disc"><li><a class="hover:text-orange-600" href="#creating-the-diagnostics-hosted-service">Creating the diagnostics hosted service</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#the-diagnosticshostedservice">The DiagnosticsHostedService</a></li></ul><li><a class="hover:text-orange-600" href="#creating-the-observers">Creating the Observers</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#implementing-idiagnosticlistener">Implementing IDiagnosticListener</a></li><li><a class="hover:text-orange-600" href="#simplediagnosticlistenerobserver">SimpleDiagnosticListenerObserver</a></li><li><a class="hover:text-orange-600" href="#creating-the-outboundhttprequestobserver">Creating the OutboundHttpRequestObserver</a></li><li><a class="hover:text-orange-600" href="#creating-the-outboundhttpresponseobserver">Creating the OutboundHttpResponseObserver</a></li></ul><li><a class="hover:text-orange-600" href="#creating-metrics-from-the-context-of-the-request">Creating metrics from the context of the request</a></li></ul></nav><section itemprop="articleBody"><p>Throughout the course of my Diagnostics in .Net Core series, we&rsquo;ve taken a look at the basics of how to use the Event Counters API. In this article, we will take a look at how we can capture all outbound HTTP requests automatically as they occur.</p><p>Our implementation is going to use a number of technologies combined to get the information that we require about the web request. Here are the steps that we need to complete:</p><ol><li>Create a service that hooks onto DiagnosticListeners as they get created</li><li>Create a observer to listen for the start of an outbound request</li><li>Create a observer to listen for the end of an outbound request</li><li>Create metrics from the context of the request/response</li></ol><p>The classes that I&rsquo;ve added to this article are designed to give you the most flexiblity around how you extend your applications in future, including the next article. Another aim is to give the classes a single purpose to add with testability. If you do not need this level of extensiblity or testability, it should be relatively easy to merge some of the classes together. As this is already a lengthy article, I&rsquo;ve not included the tests here.</p><h2 id="creating-the-diagnostics-hosted-service">Creating the diagnostics hosted service</h2><p>Our <code>DiagnosticsHostedService</code> will help us manage the lifetime of our observers. I&rsquo;ve included here in the article for completeness, although this is an an optional step so log as you register your new <code>DiagnosticListener</code> observer via <code>DiagnosticListener.AllListeners</code> then you should be fine.</p><p>A DiagnosticListener allows us to listen for events that are published in our application, either by a third party or ourselves, for the purposes of diagnostics. The events are sent from a <code>DiagnosticSource</code> that sends us a rich payload that&rsquo;s designed for consumption within the current process. They are multi-cast in nature, meaning that multiple listeners can listen to the same event without any issues. For our use case, we will listen to a single <code>DiagnosticSource</code> with multiple observers, for testability.</p><p>Read more: <a href="https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#consuming-data-with-diagnosticlistener">Consuming Data with DiagnosticListeners</a> / <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticlistener?view=netcore-3.1">Microsoft Docs</a></p><h3 id="the-diagnosticshostedservice">The DiagnosticsHostedService</h3><p>Now that we have a basic understanding of a <code>DiagnosticListener</code> we can use this in a simple hosted service that uses a special property called <code>AllListeners</code>. This property then exposes a <code>Subscribe</code> method on which we can add our first type of observer:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DiagnosticsHostedService</span> : IHostedService
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> Observer _observer;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> IDisposable? _subscription;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> DiagnosticsHostedService(Observer observer)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _observer = observer ?? <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentNullException(nameof(observer));
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StartAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _subscription ??= DiagnosticListener.AllListeners.Subscribe(_observer);
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StopAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _subscription?.Dispose();
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>The service above helps us with managing the life-cycle of the observer and keeps hold of the subscription to ensure that it doesn&rsquo;t accidentally get cleaned up. It doesn&rsquo;t matter at which point you call <code>DiagnosticListener.AllListeners</code> because when you subscribe, you will always get all previously registered <code>DiagnosticSource</code>s and any future sources that will be created.</p><p>I&rsquo;m a fan of being able to easily extend applications by adding a new entry to our DI containers. This can be extremely helpful when doing assembly scanning. To keep with this pattern, I&rsquo;ve created a simple wrapper that facilitates this, whilst adding some safety guarantees for graceful shutdown scenarios.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Observer</span> : IObserver&lt;DiagnosticListener&gt;
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;IDiagnosticListener&gt; _listeners;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">bool</span> _complete = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Observer(IEnumerable&lt;IDiagnosticListener&gt; listeners)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _listeners = listeners?.ToList() ?? <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentNullException(nameof(listeners));
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnCompleted()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">lock</span> (_listeners)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            _complete = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnError(Exception error)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnNext(DiagnosticListener <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">lock</span> (_listeners)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (_complete)
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> listener <span style="color:#66d9ef">in</span> _listeners)
</span></span><span style="display:flex"><span>                listener.TryObserve(<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Once we&rsquo;ve hooked up the above services in DI, all that&rsquo;s left for us to do is implement the <code>IDiagnosticListener</code> interface and register some observers from within the implementation, binding the implementation of <code>IDiagnosticListener</code> and any observers into our DI container of choice along the way.</p><h2 id="creating-the-observers">Creating the Observers</h2><h3 id="implementing-idiagnosticlistener">Implementing IDiagnosticListener</h3><p>In this article, we will implement some of this functionality again when we implement the inbound metrics, so i&rsquo;ve moved the common functionality to base classes that can be re-used for other purposes. First of all, we have the <code>DiagnosticListenerBase</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DiagnosticListenerBase</span> : IDiagnosticListener
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;IDisposable&gt; _subscriptions = <span style="color:#66d9ef">new</span> List&lt;IDisposable&gt;();
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">bool</span> _disposed = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> TryObserve(DiagnosticListener diagnosticListener);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> Subscribe(DiagnosticListener diagnosticListener, IObserver&lt;KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt;&gt; observer)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">lock</span> (_subscriptions)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (_disposed)
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidOperationException(<span style="color:#e6db74">&#34;Cannot subscribe when the diagnostic listener has been disposed.&#34;</span>);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            _subscriptions.Add(diagnosticListener.Subscribe(observer));
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Dispose()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">lock</span> (_subscriptions)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> subscription <span style="color:#66d9ef">in</span> _subscriptions)
</span></span><span style="display:flex"><span>                subscription.Dispose();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            _disposed = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        OnDispose();
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> OnDispose()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>This class is intended to make sure that we manage the subscriptions correctly, just like we did with the <code>DiagnosticsHostedService</code>. We need to make sure that we have some extensibility so I&rsquo;ve added the following interface so that we can re-use it in the next article:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IDiagnosticListener</span> : IDisposable
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">void</span> TryObserve(DiagnosticListener diagnosticListener);
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p><code>DiagnosticListenerBase</code> also abstractly implements the interfaces <code>TryObserve</code> method, which our <code>OutboundHttpDiagnosticListener</code> can override and subscribe the observers that we need:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundHttpRequestDiagnosticListener</span> : DiagnosticListenerBase
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;IOutboundHttpObserver&gt; _observers;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#66d9ef">string</span> _name = <span style="color:#e6db74">&#34;HttpHandlerDiagnosticListener&#34;</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> OutboundHttpRequestDiagnosticListener(IEnumerable&lt;IOutboundHttpObserver&gt; observers)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _observers = observers.ToList();
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> TryObserve(DiagnosticListener diagnosticListener)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (diagnosticListener <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span> || !diagnosticListener.Name.Equals(_name, StringComparison.OrdinalIgnoreCase))
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> observer <span style="color:#66d9ef">in</span> _observers)
</span></span><span style="display:flex"><span>            Subscribe(diagnosticListener, observer);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>The intention here is that we only subscribe specific observers when we encounter a DiagnosticListener that&rsquo;s named <code>HttpHandlerDiagnosticListener</code>. This listener has two specific events that we need to listen for:</p><ul><li><code>System.Net.Http.Request</code> - Contains the following properties: Request, LoggingRequestId, TimeStamp</li><li><code>System.Net.Http.Response</code> - Contains the following properties: Response, LoggingRequestId, ResponseTaskStatus, TimeStamp</li></ul><p>Each of the observers that we create will have a marker interface attached to them called <code>IOutboundHttpObserver</code> so that we can plug them into our IoC container. It&rsquo;s simply defined as:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IOutboundHttpObserver</span> : IObserver&lt;KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt;&gt;
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><h3 id="simplediagnosticlistenerobserver">SimpleDiagnosticListenerObserver</h3><p>When you deal with <code>DiagnosticListener</code>s, we are dealing with the Observer pattern in C#, which means that we always need to implement the following methods: <code>OnCompleted</code>, <code>OnError</code>, <code>OnNext</code>. For our use case, we don&rsquo;t need the <code>OnCompleted</code> or <code>OnError</code> methods in any of our observers, so we can move this functionality into a base class with some additional helper methods: <code>GetDuration</code> and <code>GetValueAs</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleDiagnosticListenerObserver</span> : IObserver&lt;KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt;&gt;
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// Gets the conversion factor that&#39;s used to go from ticks to a real world time. Inspiration: https://github.com/aspnet/Extensions/blob/34204b6bc41de865f5310f5f237781a57a83976c/src/Shared/src/ValueStopwatch/ValueStopwatch.cs</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> <span style="color:#66d9ef">double</span> TimestampToTicks = TimeSpan.TicksPerSecond / (<span style="color:#66d9ef">double</span>)Stopwatch.Frequency;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> OnCompleted()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> OnError(Exception error)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> OnNext(KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; <span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">static</span> TimeSpan GetDuration(<span style="color:#66d9ef">long</span> startTimestampInTicks, <span style="color:#66d9ef">long</span> endTimestampInTicks)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> timestampDelta = endTimestampInTicks - startTimestampInTicks;
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> ticks = (<span style="color:#66d9ef">long</span>)(TimestampToTicks * timestampDelta);
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> TimeSpan(ticks);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">static</span> T GetValueAs&lt;T&gt;(KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">where</span> T : <span style="color:#66d9ef">class</span> =&gt; Unsafe.As&lt;T&gt;(<span style="color:#66d9ef">value</span>.Value);
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Each event that we receive in the is typed to be a <code>KeyValuePair&lt;string, object></code>. The key property will always represent the name of the event, while the value property will be the rich payload that&rsquo;s send by the <code>DiagnosticSource</code>.</p><p>The <code>GetDuration</code> method is inspired by the <a href="https://github.com/aspnet/Extensions/blob/34204b6bc41de865f5310f5f237781a57a83976c/src/Shared/src/ValueStopwatch/ValueStopwatch.cs">ValueStopwatch</a> code that AspNetCore has internally. This allows us to calculate the wall-clock time duration of two ticks. Incidentally, this is the same calculation method that appears to be used in the logging of inbound HTTP requests from what I can tell so far.</p><p>The <code>GetValueAs&lt;T></code> method use some <a href="https://mattwarren.org/2016/09/14/Subverting-.NET-Type-Safety-with-System.Runtime.CompilerServices.Unsafe/">CLR magic</a> to forcefully convert the type for us, ie: it does not perform type checking. We need this because the objects that come along with the events that we listen to are internal to the .Net code base, so we have to mimic the same type/properties and then cast to it so that we can access the information. A &ldquo;safer&rdquo; approach would be to use cached reflection calls, but to me, I understand that this might break in the future no matter what I do so I&rsquo;ve opted for a more performant approach.</p><h3 id="creating-the-outboundhttprequestobserver">Creating the OutboundHttpRequestObserver</h3><p>The purpose of the <code>OutboundHttpRequestObserver</code> is to extract the timestamp property that&rsquo;s contained in the <code>System.Net.Http.Request</code> event, which indicates the ticks that the request started, and attach this as a request property so that we can access it later on.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundHttpRequestObserver</span> : SimpleDiagnosticListenerObserver, IOutboundHttpObserver
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnNext(KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">value</span>.Key == <span style="color:#e6db74">&#34;System.Net.Http.Request&#34;</span>)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> data = GetValueAs&lt;TypedData&gt;(<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (data?.Request?.Properties <span style="color:#66d9ef">is</span> {})
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                data.Request.Properties[<span style="color:#e6db74">&#34;RequestTimestamp&#34;</span>] = data.Timestamp;
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TypedData</span>
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> HttpRequestMessage? Request;
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> Timestamp;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>As mentioned in the previous section, we generated a typed class so that we can access the data within the events payload. I&rsquo;ve nested a class inside of the observer to help with this, containing only the properties that I need.</p><h3 id="creating-the-outboundhttpresponseobserver">Creating the OutboundHttpResponseObserver</h3><p>The purpose of the <code>OutboundHttpResponseObserver</code> is to extract the timestamp property that&rsquo;s contained in the <code>System.Net.Http.Response</code> event, which indicates the ticks that the request finished, and calculate the duration using the request timestamp that we previously stored in the request properties.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundHttpResponseObserver</span> : SimpleDiagnosticListenerObserver, IOutboundHttpObserver
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IOutboundHttpMetricBuilder _metricBuilder;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> OutboundHttpResponseObserver(IOutboundHttpMetricBuilder metricBuilder)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _metricBuilder = metricBuilder;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnNext(KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">value</span>.Key == <span style="color:#e6db74">&#34;System.Net.Http.Response&#34;</span>)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> data = GetValueAs&lt;TypedData&gt;(<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">object?</span> requestTimestamp = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (data?.Response?.RequestMessage?.Properties?.TryGetValue(<span style="color:#e6db74">&#34;RequestTimestamp&#34;</span>, <span style="color:#66d9ef">out</span> requestTimestamp) == <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">long</span>.TryParse(requestTimestamp?.ToString(), <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> startTimestamp) == <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>                {
</span></span><span style="display:flex"><span>                    <span style="color:#75715e">// For all HTTP requests we should:</span>
</span></span><span style="display:flex"><span>                    <span style="color:#75715e">//    - Track the success (&lt;400 status code response) or failure of the API call</span>
</span></span><span style="display:flex"><span>                    <span style="color:#75715e">//    - Capture the latency of the request</span>
</span></span><span style="display:flex"><span>                    <span style="color:#66d9ef">var</span> resultCounter = (<span style="color:#66d9ef">int</span>)data.Response.StatusCode &lt; <span style="color:#ae81ff">400</span> ? _metricBuilder.GetSuccessCounter(data.Response.RequestMessage, data.Response) : _metricBuilder.GetErrorCounter(data.Response.RequestMessage, data.Response);
</span></span><span style="display:flex"><span>                    resultCounter?.Increment();
</span></span><span style="display:flex"><span>                    _metricBuilder.GetLatencyCounter(data.Response.RequestMessage, data.Response)?.WriteMetric(GetDuration(startTimestamp, data.TimeStamp).TotalMilliseconds);
</span></span><span style="display:flex"><span>                }
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TypedData</span>
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> HttpResponseMessage? Response;
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> TimeStamp;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>As mentioned in a previous section, we generated a typed class so that we can access the data within the events payload. I&rsquo;ve nested a class inside of the observer to help with this, containing only the properties that I need. Now that we have all of the data we need to generate some metrics, we can use the injected <code>IOutboundHttpMetricBuilder</code> to create the metrics that we want to track dynamically.</p><h2 id="creating-metrics-from-the-context-of-the-request">Creating metrics from the context of the request</h2><p>In our services, there are a few bits of information that I want to capture about the context of the request:</p><ol><li>Whether the request was successful or not (based on the HTTP Status code)</li><li>The duration of the request, in milliseconds</li></ol><p>With this information, we want to add metadata to the DiagnosticCounters that we generate so that we can use it as dimensions in our monitoring applications like DataDog/Prometheus. The dimensions that we are interested in include:</p><ul><li>HTTP method: GET/POST/PUT/PATCH/DELETE etc</li><li>HTTP version: 1.0/1.1/2.0 etc</li><li>HTTP scheme: HTTP/HTTPS</li><li>HTTP request type: outbound (this article)/inbound (next article)</li><li>HTTP status code: 200/201/202/204/400 etc</li><li>Request Path: <code>/search</code></li><li>Host: <code>www.google.com</code></li></ul><p>With this information, we should have more than enough to filter out specific flows easily, whilst being able to aggregate the results where needed. Each one of the properties is added to each one of the diagnostic counters that we generate:</p><ul><li>Success Counter</li><li>Error Counter</li><li>Latency Counter</li></ul><p>To allow us to override the implementation later on, we can use the following interface:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IOutboundHttpMetricBuilder</span>
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    IncrementingEventCounter? GetSuccessCounter(HttpRequestMessage request, HttpResponseMessage response);
</span></span><span style="display:flex"><span>    IncrementingEventCounter? GetErrorCounter(HttpRequestMessage request, HttpResponseMessage response);
</span></span><span style="display:flex"><span>    EventCounter? GetLatencyCounter(HttpRequestMessage request, HttpResponseMessage response);
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p><strong>Note:</strong> <em>For a summary of the different types of event counters, please see <a href="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/">this article</a>.</em></p><p>For the sake of brevity of this article, I&rsquo;m not going to explain all of the below, rather the general concept. Here, the intention is to have a core set of dimensions (listed above) that are are also used to de-duplicate the number of counters that we create overall. Lastly, we have a custom comparer so that we can compare the values of the <code>List</code> that we generate for each type of metric, rather than relying on the default equality comparer. This helps us ensure that we have semantic rather than reference equality.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#75715e">/// &lt;remarks&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#75715e">/// We don&#39;t want to add new event counters all the time to the system. So based on the tags, we maintain a list for success/errors/latency.</span>
</span></span><span style="display:flex"><span><span style="color:#75715e">/// Because we are storing based on semantic equivalents, we need a custom comparer to ensure that we have uniqueness, this is guarenteed in two ways:</span>
</span></span><span style="display:flex"><span><span style="color:#75715e">///     - Ensuring that hashcodes are generated using a semantic method, given that inputs are the always given in the same ordered way</span>
</span></span><span style="display:flex"><span><span style="color:#75715e">///     - When we check for equality, assuming the hashcodes match, we each that the sequences are equal using a performant version of Enumerable.SequenceEquals (as this is going to be called ALOT!)</span>
</span></span><span style="display:flex"><span><span style="color:#75715e">/// &lt;/remarks&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultOutboundHttpMetricBuilder</span> : IOutboundHttpMetricBuilder
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, IncrementingEventCounter&gt; _successCounters = <span style="color:#66d9ef">new</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, IncrementingEventCounter&gt;(<span style="color:#66d9ef">new</span> ListOfTupleEqualityComparer());
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, IncrementingEventCounter&gt; _errorCounters = <span style="color:#66d9ef">new</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, IncrementingEventCounter&gt;(<span style="color:#66d9ef">new</span> ListOfTupleEqualityComparer());
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, EventCounter&gt; _latencyCounters = <span style="color:#66d9ef">new</span> ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, EventCounter&gt;(<span style="color:#66d9ef">new</span> ListOfTupleEqualityComparer());
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> IncrementingEventCounter GetSuccessCounter(HttpRequestMessage request, HttpResponseMessage response) =&gt; GetCoreHttpRequestCounter(_successCounters, request, response);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> IncrementingEventCounter GetErrorCounter(HttpRequestMessage request, HttpResponseMessage response) =&gt; GetCoreHttpRequestCounter(_errorCounters, request, response);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> EventCounter GetLatencyCounter(HttpRequestMessage request, HttpResponseMessage response)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> _latencyCounters.GetOrAdd(GetCoreTags(request, response), key =&gt;
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> counter = <span style="color:#66d9ef">new</span> EventCounter(<span style="color:#e6db74">&#34;http-request-latency&#34;</span>, MyDiagnosticsEventSource.Instance)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                DisplayName = <span style="color:#e6db74">&#34;HTTP Request Latency&#34;</span>,
</span></span><span style="display:flex"><span>                DisplayUnits = <span style="color:#e6db74">&#34;ms&#34;</span>
</span></span><span style="display:flex"><span>            };
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> dimension <span style="color:#66d9ef">in</span> key)
</span></span><span style="display:flex"><span>                counter.AddMetadata(dimension.key, dimension.<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>            MyDiagnosticsEventSource.Instance.AddDiagnosticCounter(counter);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> counter;
</span></span><span style="display:flex"><span>        });
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> IncrementingEventCounter GetCoreHttpRequestCounter(ConcurrentDictionary&lt;List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt;, IncrementingEventCounter&gt; collection, HttpRequestMessage request, HttpResponseMessage response)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> collection.GetOrAdd(GetCoreTags(request, response), key =&gt;
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            Debug.WriteLine(<span style="color:#e6db74">&#34;CREATED NEW COUNTER: &#34;</span> + <span style="color:#66d9ef">string</span>.Join(<span style="color:#e6db74">&#34;,&#34;</span>, key.Select(x =&gt; <span style="color:#e6db74">$&#34;{x.key}:{x.value}&#34;</span>)));
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> counter = <span style="color:#66d9ef">new</span> IncrementingEventCounter(<span style="color:#e6db74">&#34;http-request&#34;</span>, MyDiagnosticsEventSource.Instance)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                DisplayName = <span style="color:#e6db74">&#34;HTTP Request Count&#34;</span>,
</span></span><span style="display:flex"><span>                DisplayUnits = <span style="color:#e6db74">&#34;requests&#34;</span>
</span></span><span style="display:flex"><span>            };
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> dimension <span style="color:#66d9ef">in</span> key)
</span></span><span style="display:flex"><span>                counter.AddMetadata(dimension.key, dimension.<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>            MyDiagnosticsEventSource.Instance.AddDiagnosticCounter(counter);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> counter;
</span></span><span style="display:flex"><span>        });
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> List&lt;(<span style="color:#66d9ef">string</span> key, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>)&gt; GetCoreTags(HttpRequestMessage request, HttpResponseMessage response)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> path = request.RequestUri.PathAndQuery;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrWhiteSpace(path))
</span></span><span style="display:flex"><span>            path = <span style="color:#e6db74">&#34;/&#34;</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (path.Length &gt; <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> initialPartIndex = path.IndexOf(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (initialPartIndex &gt; <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>                path = path.Substring(<span style="color:#ae81ff">0</span>, initialPartIndex);
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">var</span> queryIndex = path.IndexOf(<span style="color:#e6db74">&#39;?&#39;</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">if</span> (queryIndex &gt;= <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex"><span>                    path = path.Substring(<span style="color:#ae81ff">0</span>, queryIndex);
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> tags = <span style="color:#66d9ef">new</span> List&lt;(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>)&gt;
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;http-method&#34;</span>, request.Method.ToString()),
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;http-version&#34;</span>, request.Version.ToString()),
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;http-scheme&#34;</span>, request.RequestUri.Scheme),
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;http-request-type&#34;</span>, <span style="color:#e6db74">&#34;outbound&#34;</span>),
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;http-status-code&#34;</span>, ((<span style="color:#66d9ef">int</span>)response.StatusCode).ToString()),
</span></span><span style="display:flex"><span>            (<span style="color:#e6db74">&#34;request-path&#34;</span>, path)
</span></span><span style="display:flex"><span>        };
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (request.RequestUri.IsAbsoluteUri)
</span></span><span style="display:flex"><span>            tags.Add((<span style="color:#e6db74">&#34;host&#34;</span>, request.RequestUri.Authority));
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> tags;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ListOfTupleEqualityComparer</span> : EqualityComparer&lt;List&lt;(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>)&gt;&gt;
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">bool</span> Equals(List&lt;(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>)&gt; left, List&lt;(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>)&gt; right)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (left.Count != right.Count)
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> (left.Count == <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>; <span style="color:#75715e">// Both are 0</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">using</span> var iterator2 = right.GetEnumerator();
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> element <span style="color:#66d9ef">in</span> left)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                <span style="color:#75715e">// second is shorter than first</span>
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">if</span> (!iterator2.MoveNext())
</span></span><span style="display:flex"><span>                {
</span></span><span style="display:flex"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>                }
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">if</span> (!(element.Item1.Equals(iterator2.Current.Item1) &amp;&amp; element.Item2.Equals(iterator2.Current.Item2)))
</span></span><span style="display:flex"><span>                {
</span></span><span style="display:flex"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex"><span>                }
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>            <span style="color:#75715e">// If we can get to the next element, first was shorter than second.</span>
</span></span><span style="display:flex"><span>            <span style="color:#75715e">// Otherwise, the sequences are equal.</span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> !iterator2.MoveNext();
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">int</span> GetHashCode(List&lt;(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>)&gt; obj)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">var</span> code = <span style="color:#ae81ff">17</span>;
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> element <span style="color:#66d9ef">in</span> obj)
</span></span><span style="display:flex"><span>                code = HashCode.Combine(code, element.Item1.GetHashCode(), element.Item2.GetHashCode());
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span> code;
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Naturally, if you use another method like the response body to figure out whether the request was successful or not then you will need to do additional work with the contents of the request. This will be outside the context of this post. Hopefully, you now have all the bits that you would need to build this out in your own applications. In the next article, we will be taking a look at how we mimic the same technique for accurately tracking inbound requests using a lot of the same components that we have built out in this article. Happy request tracking!</p></section><div class="mt-4 border-t border-slate-400"><p><a href="https://im5tu.io/about/" title="About Stuart Blackler">Stuart Blackler</a> is a seasoned technologist with over 15 years of commercial experience in the .NET ecosystem.
Holding a degree in Computer Science, Stuart has earned
certifications as a C# developer through Microsoft and as an AWS Solutions Architect and Developer. Stuart is
the creator of the popular YouTube channel <a href="https://youtube.com/@codewithstu">CodeWithStu</a>, where he delves into topics close to his heart, including .NET, AWS, DevOps,
and software architecture with a commitment to sharing knowledge and fostering a community of learners.</p></div><div class="mt-4 border-t border-slate-400"><p><a name="series"></a><b>More in the <i>'Diagnostics in .Net Core 3'</i> series:</b></a></p><ol><li><a href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-an-alternative-approach-to-using-dotnet-counters-with-docker/">Diagnostics in .Net Core 3: An alternative approach to using dotnet-counters with Docker</a></li><li><a href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-inbound-http-requests/">Diagnostics in .Net Core 3: Listening to inbound HTTP requests</a></li><li><b>Diagnostics in .Net Core 3: Listening to outbound HTTP requests <i>(This article)</i></b></li><li><a href="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-using-dotnet-counters-with-docker/">Diagnostics in .Net Core 3: Using dotnet-counters with Docker</a></li><li><a href="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/">Diagnostics in .Net Core 3: Event Counters</a></li></ol></div></article></div></main><footer class="border-t border-gray-900/10 py-12 sm:py-6 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-gray-800 via-gray-900 to-black"><div><div class="hidden lg:flex lg:flex-1 justify-center mb-12"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">About</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Articles</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Learn</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Videos</a></div><div class="flex justify-center space-x-12 my-6"><a href="https://www.youtube.com/@CodeWithStu?sub_confirmation=1" class="text-gray-400 hover:text-orange-500" target="_blank" title="Subscribe To Me On YouTube"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></svg></a><a href="https://www.linkedin.com/in/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Connect With Me LinkedIn"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.98 3.5C4.98 4.881 3.87 6 2.5 6s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zM5 8H0v16h5V8zm7.982.0H8.014v16h4.969v-8.399c0-4.67 6.029-5.052 6.029.0V24H24V13.869c0-7.88-8.922-7.593-11.018-3.714V8z"/></svg></a><a href="https://github.com/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Follow Me On GitHub"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-xs leading-5 text-gray-500">&copy; 2023 <a href="https://im5tu.io/" class="hover:text-orange-500">im5tu.io</a> - All rights reserved.</p></div></div></footer><script>document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("menuOpen"),t=document.getElementById("menuClose"),n=document.getElementById("mobileMenu");t&&e&&(t.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}),e.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}))})</script></body></html>
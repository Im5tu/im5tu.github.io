<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Stuart Blackler "><meta name="description" content="A look into how we implement simple feature toggles using IConfiguration"><meta name="keywords" content=",aspnet,dotnet,csharp"><meta name="robots" content="noodp"><meta name="theme-color" content><link rel="canonical" href="https://im5tu.io/article/2020/08/implementing-simple-feature-toggles-in-aspnetcore-using-iconfiguration/"><title>Implementing Simple Feature Toggles In AspNetCore Using IConfiguration :: CodeWithStu's Blog</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://im5tu.io/main.b78c3be9451dc4ca61ca377f3dc2cf2e6345a44c2bae46216a322ef366daa399.css" integrity="sha256-t4w76UUdxMphyjd/PcLPLmNFpEwrrkYhajIu82bao5k="><link rel="apple-touch-icon" sizes="180x180" href="https://im5tu.io/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://im5tu.io/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://im5tu.io/favicon-16x16.png"><link rel="manifest" href="https://im5tu.io/site.webmanifest"><link rel="mask-icon" href="https://im5tu.io/safari-pinned-tab.svg" color><link rel="shortcut icon" href="https://im5tu.io/favicon.ico"><meta name="msapplication-TileColor" content><meta itemprop="name" content="Implementing Simple Feature Toggles In AspNetCore Using IConfiguration"><meta itemprop="description" content="A look into how we implement simple feature toggles using IConfiguration"><meta itemprop="datePublished" content="2020-08-29T11:45:00+01:00"><meta itemprop="dateModified" content="2020-08-29T11:45:00+01:00"><meta itemprop="wordCount" content="657"><meta itemprop="keywords" content="aspnet,dotnet,csharp,"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Implementing Simple Feature Toggles In AspNetCore Using IConfiguration"><meta name="twitter:description" content="A look into how we implement simple feature toggles using IConfiguration"><meta property="og:title" content="Implementing Simple Feature Toggles In AspNetCore Using IConfiguration"><meta property="og:description" content="A look into how we implement simple feature toggles using IConfiguration"><meta property="og:type" content="article"><meta property="og:url" content="https://im5tu.io/article/2020/08/implementing-simple-feature-toggles-in-aspnetcore-using-iconfiguration/"><meta property="article:section" content="article"><meta property="article:published_time" content="2020-08-29T11:45:00+01:00"><meta property="article:modified_time" content="2020-08-29T11:45:00+01:00"><meta property="article:section" content="Development"><meta property="article:published_time" content="2020-08-29 11:45:00 +0100 +0100"><meta property="og:image" content="https://im5tu.io/img/profile.png"><meta property="og:site_name" content="CodeWithStu's Blog"><link rel="alternate" type="application/rss+xml" href="https://im5tu.io/article/index.xml" title="Stuart Blackler's Blog"><link rel="preconnect" href="https://api.github.com"><link rel="preconnect" href="https://partner.googleadservices.com"><link rel="preconnect" href="https://tpc.googlesyndication.com"><link rel="preconnect" href="https://www.googletagservices.com"><link rel="preconnect" href="https://googleads.g.doubleclick.net"><link rel="preconnect" href="https://pagead2.googlesyndication.com"><link rel="preload" href="https://im5tu.io/fonts/Inter-UI-Bold.woff2"><link rel="preload" href="https://im5tu.io/fonts/Inter-UI-Regular.woff2"><style>body p{line-height:1.8em}main{padding:4em 0 0}a:hover{color:#004dc9}.post,.posts{max-width:1400px;padding:2em 0 0}.header__inner{width:100%;max-width:1400px}ul.menu__inner{padding-right:0}ul.menu__inner li:last-of-type{margin-right:0}.logo__cursor{background:#3b82f6}.toolbar{display:none!important}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border-left:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2;border-radius:0;border-bottom-left-radius:10px;transition:all 250ms ease;margin:-18px;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}table{width:100%;border-collapse:collapse}table th{background-color:#cecece;color:#222}table tr{margin:0;padding:0}table tr:first-child{border-left:1px solid #acacac;border-top:1px solid #acacac;border-right:1px solid #acacac}table tr td:first-child{border-left:1px solid #acacac}table tr td:last-child{border-right:1px solid #acacac}table td,table th{padding:.5em;border-bottom:1px solid #acacac;margin:0}h2{margin-top:1.5em}h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{text-decoration:none}h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover{text-decoration:underline}#promotions img{margin:20px auto}#sponsorMessage{width:100%;background:#ffdf00;color:#242325;padding:10px;font-size:.9em}.flex-container{width:100%;display:inline-flex;justify-content:space-between}.flex-box{display:block}.hidden{display:hidden}.post-title{font-weight:700}.post-summary{font-style:italic;font-size:.8em;color:#222}.post-tags{font-size:.9em}.post-tags span.tag{margin:0 .5em;color:#111;text-decoration:underline}#introduction{margin:0 auto;text-align:center}#introduction p{display:block;text-align:center}#introduction p:first-child{font-weight:700;font-size:1.4em}#introduction p:nth-child(2){font-size:1.3em;font-style:italic}#introduction-container{width:80%;max-width:1400px;text-align:center}#introduction-whatido{margin-top:2em;background-color:#fafafa;width:100%;padding:3em 0}#introduction-whatido *{text-align:center}#introduction-whatido p{text-align:left}#introduction-whatido .flex-box{margin:0 2.5em;width:100%}#introduction-whatido .flex-box span.home-link{font-size:1.8em;margin-bottom:2em;color:#0665ff;font-weight:700;text-align:center}#introduction-whatido .flex-box span.home-link a,#introduction-whatido .flex-box span.home-link a:link{text-align:center;text-decoration:none}.footer{padding:0}#scroll-progress{position:fixed;top:0;width:0%;height:4px;background:#0665ff;z-index:10000}@media print{.copy-code-button{display:none}}@media(prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}.post-summary,.post-tags span.tag{color:#eaeaea}}@media(max-width:1450px){.post,.posts,main{padding:2em 4em}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-QLMVXHCJ5K"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QLMVXHCJ5K")</script><script data-ad-client="ca-pub-8597760177900459" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div class="container"><header class="header"><span class="header__inner"><a href="https://im5tu.io/" style="text-decoration:none"><div class="logo"><span class="logo__mark">></span>
<span class="logo__text">im5tu.io</span>
<span class="logo__cursor"></span></div></a><span class="header__right"><nav class="menu"><ul class="menu__inner"><li><a href="https://im5tu.io/article/">Blog</a></li><li><a href="https://news.codewithstu.tv">Newsletter</a></li><li><a href="https://www.patreon.com/CodeWithStu">Patreon</a></li><li><a href="https://twitter.com/CodeWithStu">Twitter</a></li><li><a href="https://codewithstu.tv">YouTube</a></li></ul></nav><span class="menu-trigger"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div id="scroll-progress"></div><div class="content"><main class="post"><div style="font-style:italic;width:100%;background-color:#ffe12b;color:#333;text-align:center;padding:1px"><p>This page is available to sponsor. <a id="sponsorLink" href="https://im5tu.io/sponsorship/" ref="nofollow" target="_blank">Click Here</a> for more details!</p></div><div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 minutes</p></div><article><h1 class="post-title"><a href="https://im5tu.io/article/2020/08/implementing-simple-feature-toggles-in-aspnetcore-using-iconfiguration/">Implementing Simple Feature Toggles In AspNetCore Using IConfiguration</a></h1><hr><aside id="toc"><div class="toc-title">Table of Contents</div><nav id="TableOfContents"><ul><li><a href="#what-are-feature-toggles">What are feature toggles?</a></li><li><a href="#configuration-system-in-net-core">Configuration System in .NET Core</a></li><li><a href="#building-out-simple-feature-toggles-using-iconfiguration">Building out simple feature toggles using IConfiguration</a></li></ul></nav></aside><hr><div class="post-content"><p>Recently, we&rsquo;ve had the need to build a few feature toggles in our applications that can be changed at runtime. This article walks through a simple approach that you can use in your applications, including a description of a route to dynamic feature toggles.</p><p>We&rsquo;ve built out our feature toggle system on top of the <code>IConfiguration</code> in ASP.NET Core as we do not need anything particularly fancyand we already have the packages referenced in our applications. If we needed something more advanced, we would take a look into one of the many available packages. If you just need something simple, you&rsquo;re in the right place.</p><p>If you already know what feature toggles are and you&rsquo;re familiar with the configuration model in ASP.NET Core, jump straight to <a href="#building-out-simple-feature-toggles-using-iconfiguration">Building out simple feature toggles using IConfiguration</a>.</p><h2 id="what-are-feature-toggles">What are feature toggles?</h2><p>Also known as feature flags, feature toggles are a technique in software development to enable certain functionality in an application. Typically this happens when releasing new functionality to consumers, but can also be used to sunset features or provide a global on/off switch (for example).</p><h2 id="configuration-system-in-net-core">Configuration System in .NET Core</h2><p>Since the beginning of .NET Core, the ASP.NET team has rebuilt the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-3.1">configuration</a> and <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-3.1">options</a> system to provide a decent abstraction that can be used inside and outside of ASP.NET Core. The configuration is provided by the <a href="https://www.nuget.org/packages/Microsoft.Extensions.Configuration">Microsoft.Extensions.Configuration</a> NuGet package. This package takes care of the &ldquo;how do I locate my settings&rdquo; part of the problem by providing an simple <code>IConfiguration</code> abstraction.</p><p>The second part of the problem is accessing the configuration, which is where the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-3.1">options model</a> comes into play. The <a href="https://www.nuget.org/packages/Microsoft.Extensions.Options">Microsoft.Extensions.Options</a> package gives us abstractions to retrieve configuration from the <code>IConfiguration</code> abstraction the configuration model provides, while providing hooks for validation and post-configuration.</p><p>Both the configuration and options packages are included by default when building out an ASP.NET core application. For service workers, you may need to install these packages manually.</p><h2 id="building-out-simple-feature-toggles-using-iconfiguration">Building out simple feature toggles using IConfiguration</h2><p>In order to build a simple feature toggle system, we first need a class that will hold our feature toggles:</p><pre><code class="language-csharp">public class FeatureToggles
{
    public bool MyFirstToggle { get; set; }
}
</code></pre><p>Next, we need to add a new configuration source to our host builder which tells the application where we should look for our configuration:</p><pre><code class="language-csharp">Host.CreateDefaultBuilder()
    .ConfigureAppConfiguration(builder =&gt; {
        // Adds environment variables prefixed with STU_TEST
        // Note: the prefix will be removed from the environment variable
        builder.AddEnvironmentVariables(&quot;STU_TEST&quot;);
    })
    .Build()
    .Run();
</code></pre><p>So long as the configuration provider you added supports the updating of a feature flag, it can be changed at runtime from an external source like <a href="https://www.consul.io/">consul</a>, or even within your application itself. When we have our configuration source configured, we need to tell our application how to link a configuration section to the <code>FeatureToggles</code> class:</p><pre><code class="language-csharp">public class Startup
{
    public IConfiguration Configuration { get; }

    public Startup(IConfiguration configuration) { Configuration = configuration; }

    public void ConfigureServices(IServiceCollection services)
    {
        // May require you to include Microsoft.Extensions.Configuration.Binder
        services.Configure&lt;FeatureToggles&gt;(Configuration.GetSection(&quot;FeatureToggles&quot;));
    }
}
</code></pre><p>In the sample above, we have injected the application configuration into the startup class so that we can access all of the configuration that has built because we need access to the <code>FeatureToggles</code> section of that configuration. The only bit that is left is to access the configuration:</p><pre><code class="language-csharp">public class SampleController : ControllerBase
{
    private readonly FeatureToggles _featureToggles;

    public SampleController(IOptionsSnapshot&lt;FeatureToggles&gt; featureToggles)
    {
        _featureToggles = featureToggles.Value;
    }

    [HttpGet(&quot;/my-first-toggle&quot;)]
    public IActionResult MyFirstToggle()
    {
        return Ok($&quot;The value of MyFirstToggle is: {_featureToggles.MyFirstToggle}&quot;);
    }
}
</code></pre><p>If we now submit a request to <code>/my-first-toggle</code> we should now see the current value returned to us as part of the response. When consuming the options from a scoped context, eg: a http request, ensure to always use <code>IOptionsSnapshot&lt;T></code> (or <code>IOptionsMonitor&lt;T></code> if snapshot is not possible - but check the documentation to view the differences) as this ensures consistency for the settings in that scope and has some additional performance benefits.</p><p>That&rsquo;s it, simple feature toggles. Happy Toggling!</p></div></article><hr><div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class="tag"><a href="https://im5tu.io/tags/aspnet/">aspnet</a></span><span class="tag"><a href="https://im5tu.io/tags/dotnet/">dotnet</a></span><span class="tag"><a href="https://im5tu.io/tags/csharp/">csharp</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>657 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-08-29</p></div><hr><div id="promotions"><a href="https://geni.us/cws-springer" target="_blank"><img src="https://www.awltovhc.com/image-100677210-15518210" width="728" height="90" alt="Apress eBook Sale is here now! - Order selected eBooks for $12.99 each. (3rd-20th May)"></a>
<a href="https://geni.us/cws-namecheap" target="_blank"><img src="https://www.awltovhc.com/image-100677210-14326263" width="728" height="90" alt="Popular Domains for just 99 Cents at Namecheap!"></a>
<a href="https://geni.us/cws-mailchimp" target="_blank"><img src="https://www.ftjcfx.com/image-100677210-15488213" width="728" height="90" alt="See upto 88% more revenue with predictive segments!"></a></div></main></div><footer class="footer"><hr><div class="footer__inner"><div class="footer__content"><iframe src="https://codewithstu.substack.com/embed" width="480" height="320" frameborder="0" scrolling="no"></iframe></div></div><hr><div><div class="footer__inner"><div class="footer__content"><span>&copy; 2023</span>
<span><a href="https://im5tu.io/">Stuart Blackler</a></span>
<span><a href="https://im5tu.io/article/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div><p><a href="https://im5tu.io/tags">Tags</a> | <a href="https://im5tu.io/categories">Categories</a> | <a href="https://im5tu.io/sitemap.xml">Sitemap</a></p></div><div><p>This site uses Google Analytics for Analytics only, so may contain cookies.</p></div></div></footer></div><script type="text/javascript" src="https://im5tu.io/bundle.min.205d491810c28f95aa953fae884e1c27abe13fdf93ec63b882d0036b248d4a6282eb2d134e4e7225c6ad6e86db87b08488a361ca4a7383d01fcff43f3d57b9c3.js" integrity="sha512-IF1JGBDCj5WqlT+uiE4cJ6vhP9+T7GO4gtADaySNSmKC6y0TTk5yJcatbobbh7CEiKNhykpzg9Afz/Q/PVe5ww=="></script>
<script src="https://im5tu.io/js/site-004f8284.js" defer></script></body></html>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>November on CodeWithStu's Blog</title><link>https://im5tu.io/article/2020/11/</link><description>Recent content in November on CodeWithStu's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-gb</language><atom:link href="https://im5tu.io/article/2020/11/index.xml" rel="self" type="application/rss+xml"/><item><title>Using Moq with ref, in and out parameters in C#</title><link>https://im5tu.io/article/2020/11/using-moq-with-ref-in-and-out-parameters-in-c/</link><pubDate>Sat, 28 Nov 2020 12:39:52 +0000</pubDate><guid>https://im5tu.io/article/2020/11/using-moq-with-ref-in-and-out-parameters-in-c/</guid><description>&lt;p>In this article, I want to take a look at a scenario that I came across this week which I&amp;rsquo;ve come across a few times. Occasionally, you will have an interface that you wish to mock out with Moq and find you have troubles because the method signature takes a &lt;code>ref&lt;/code> or an &lt;code>out&lt;/code> parameter. This week, I&amp;rsquo;ve found a way that we can successfully mock the method without too much of a change to the test code.&lt;/p>
&lt;p>Lets assume that we have the following implementation that we want to mock out using Moq, which is a simplification of the problem I had earlier in the week:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">IVisitor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> Visit(&lt;span style="color:#66d9ef">ref&lt;/span> MyType type);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here&amp;rsquo;s the class that we are going to test:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyVisitorRunner&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">readonly&lt;/span> IEnumerable&amp;lt;IVisitor&amp;gt; _visitors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> MyVisitorRunner(IEnumerable&amp;lt;IVisitor&amp;gt; visitors)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _visitors = visitors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> Visit(&lt;span style="color:#66d9ef">ref&lt;/span> MyType type)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">foreach&lt;/span> (&lt;span style="color:#66d9ef">var&lt;/span> visitor &lt;span style="color:#66d9ef">in&lt;/span> _visitors)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (!visitor.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> type))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We want to have a simple test that ensures that all the visitors are called. So using XUnit, we could write something along the lines of:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">[Fact]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> MustCallAllVisitors()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor1 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor2 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.IsAny&amp;lt;MyType&amp;gt;())).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.IsAny&amp;lt;MyType&amp;gt;())).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> target = &lt;span style="color:#66d9ef">new&lt;/span> MyVisitorRunner(&lt;span style="color:#66d9ef">new&lt;/span> [] { visitor1.Object, visitor2.Object });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> subject = &lt;span style="color:#66d9ef">new&lt;/span> MyType();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> target.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> subject);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.IsAny&amp;lt;MyType&amp;gt;()), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.IsAny&amp;lt;MyType&amp;gt;()), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>But this gives us the compile time error of &lt;code>A ref or out value must be assignable to a variable&lt;/code>. So if we take a look at what happens when we do as the compiler says and assign it to a variable:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">[Fact]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> MustCallAllVisitors()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor1 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor2 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> type = It.IsAny&amp;lt;MyType&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> type)).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> type)).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> target = &lt;span style="color:#66d9ef">new&lt;/span> MyVisitorRunner(&lt;span style="color:#66d9ef">new&lt;/span> [] { visitor1.Object, visitor2.Object });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> subject = &lt;span style="color:#66d9ef">new&lt;/span> MyType();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> target.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> subject);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> type), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> type), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It now compiles correctly, but when the tests execute you receive the following error:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-plain" data-lang="plain">&lt;span style="display:flex;">&lt;span>Moq.MockException
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Expected invocation on the mock once, but was 0 times: x =&amp;gt; x.Visit(null)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Performed invocations:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Mock&amp;lt;IVisitor:1&amp;gt; (x):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IVisitor.Visit(MyType)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at Moq.Mock.Verify(Mock mock, LambdaExpression expression, Times times, String failMessage) in C:\projects\moq4\src\Moq\Mock.cs:line 354
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at Moq.Mock`1.Verify[TResult](Expression`1 expression, Func`1 times) in C:\projects\moq4\src\Moq\Mock.Generic.cs:line 880
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Moq version 4.8 (or later) has improved support for by-ref parameters by introducing &lt;code>It.Ref&amp;lt;T&amp;gt;.IsAny&lt;/code> which works on &lt;code>ref&lt;/code>, &lt;code>in&lt;/code> (since they are by-ref parameters) and &lt;code>out&lt;/code> parameters. We can use this changing our code to &lt;code>visitor1.Setup(x =&amp;gt; x.Visit(ref It.Ref&amp;lt;MyType&amp;gt;.IsAny)).Returns(true);&lt;/code> as shown below:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">[Fact]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> MustCallAllVisitors()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor1 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> visitor2 = &lt;span style="color:#66d9ef">new&lt;/span> Mock&amp;lt;IVisitor&amp;gt;();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.Ref&amp;lt;MyType&amp;gt;.IsAny)).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Setup(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.Ref&amp;lt;MyType&amp;gt;.IsAny)).Returns(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> target = &lt;span style="color:#66d9ef">new&lt;/span> MyVisitorRunner(&lt;span style="color:#66d9ef">new&lt;/span> [] { visitor1.Object, visitor2.Object });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> subject = &lt;span style="color:#66d9ef">new&lt;/span> MyType();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> target.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> subject);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor1.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.Ref&amp;lt;MyType&amp;gt;.IsAny), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor2.Verify(x =&amp;gt; x.Visit(&lt;span style="color:#66d9ef">ref&lt;/span> It.Ref&amp;lt;MyType&amp;gt;.IsAny), Times.Once);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If we now run our tests, we see that it works as we expect, fixing the original issue. As the same approach works for &lt;code>in&lt;/code> and &lt;code>out&lt;/code> parameters, I&amp;rsquo;ll leave this as an exercise for you dear reader. I hope that you&amp;rsquo;ve found this little tip help, happy mocking!&lt;/p></description></item><item><title>A Look Into CloudEvents</title><link>https://im5tu.io/article/2020/11/a-look-into-cloudevents/</link><pubDate>Sat, 21 Nov 2020 11:34:07 +0000</pubDate><guid>https://im5tu.io/article/2020/11/a-look-into-cloudevents/</guid><description>&lt;p>Over the past few months, I&amp;rsquo;ve been looking into the internal architecture setup for &lt;a href="https://checkout.com">Checkout.com&lt;/a> and seeing how we can scale it for the next few years. As part of that research, I&amp;rsquo;ve been looking into the CloudEvents specification as a potential option as the basis for a common event schema across teams.&lt;/p>
&lt;h2 id="what-are-cloudevents">What are CloudEvents?&lt;/h2>
&lt;p>CloudEvents is a &lt;a href="https://www.cncf.io/projects/">Cloud Native Computing Foundation&lt;/a> incubating project that provides &lt;a href="https://github.com/cloudevents/spec/blob/master/spec.md">a specification&lt;/a> for describing event data in a common way ensuring that teams have consistency in their applications, helping to reduce some of the errors traditionally faced and simplifying integrations. Traditionally, different teams &amp;amp; third-party providers have different structures to their events, even with the same organisation.&lt;/p>
&lt;p>CloudEvents, at its core, defines a set of metadata, called attributes, about the event being transferred between systems, and how those pieces of metadata should appear in that message. This metadata is meant to be the minimal set of information needed to route the request to the proper component and to facilitate proper processing of the event by that component. &lt;em>(&lt;a href="https://github.com/cloudevents/spec/blob/master/primer.md#design-goals">Source&lt;/a>)&lt;/em>&lt;/p>
&lt;p>Interestingly, the CloudEvents project also explicitly lists the non-goals for the project (ie: the stuff that&amp;rsquo;s out of scope):&lt;/p>
&lt;ul>
&lt;li>Function build and invocation process&lt;/li>
&lt;li>Language-specific runtime APIs&lt;/li>
&lt;li>Selecting a single identity/access control system&lt;/li>
&lt;li>Inclusion of protocol-level routing information&lt;/li>
&lt;li>Event persistence processes&lt;/li>
&lt;li>Mechanism for Authorization, Data Integrity and Confidentiality&lt;/li>
&lt;/ul>
&lt;h2 id="what-does-a-cloudevent-look-like">What does a CloudEvent look like?&lt;/h2>
&lt;p>As all CloudEvents implementations must support the JSON format, we can take a look at a minimal payload here:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;A234-1234-1234&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;source&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;https://github.com/cloudevents/spec/pull&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;specversion&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;1.x-wip&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;com.github.pull_request.opened&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>All of the fields listed above are required in all formats of CloudEvents. The &lt;code>id&lt;/code> field identifies the event which producers ensure is unique for a given &lt;code>source&lt;/code>. The &lt;code>source&lt;/code> identifies the context in which an event happened. Often this will include information such as the type of the event source, the organization publishing the event or the process that produced the event. The &lt;code>specversion&lt;/code> describes the version of the CloudEvents specification that the event adheres to.&lt;/p>
&lt;p>The specification also includes some additional optional attributes, which can be seen here:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;A234-1234-1234&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;source&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;https://github.com/cloudevents/spec/pull&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;specversion&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;1.x-wip&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;com.github.pull_request.opened&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;data&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;lt;much wow=\&amp;#34;xml\&amp;#34;/&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;datacontenttype&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text/xml&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;dataschema&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/teams/sega/cloud_event.json&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;subject&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;et_245435943&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;time&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2019-10-12T07:20:50.52Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Should a producer want to include domain specific information about the event occurrence, they must encapsulate this information inside of the &lt;code>data&lt;/code> field. The &lt;code>datacontenttype&lt;/code> field will then describe the format of the data field, for example &lt;code>application/json&lt;/code>. If the &lt;code>datacontenttype&lt;/code> field is omitted, then its assumed that the &lt;code>data&lt;/code> field, if present, is of type &lt;code>application/json&lt;/code>. Another field that directly relates to the data field, if present, is &lt;code>dataschema&lt;/code>. This field identifies the schema that the &lt;code>data&lt;/code> field adheres to, as a URI reference. The &lt;code>subject&lt;/code> field describes the object/instance that the event is in reference to within the context of the producer. In other words, it could be the name of a EC2 instance, a file in Azure blob storage or a user id. Lastly, the &lt;code>time&lt;/code> field is the timestamp in format of &lt;a href="https://tools.ietf.org/html/rfc3339">RFC 3339&lt;/a> (eg: &lt;code>2019-10-12T07:20:50.52Z&lt;/code> (ISO8601 compatible) or &lt;code>2019-10-12 07:20:50.52Z&lt;/code> (&lt;strong>not&lt;/strong> ISO8601 compatible)) of when the event occurred.&lt;/p>
&lt;p>The &lt;a href="https://github.com/cloudevents/spec/blob/master/json-format.md">json format&lt;/a> also allows for messages to be batched together. When this occurs, the &lt;code>type&lt;/code> field must be set to &lt;code>application/cloudevents-batch+json&lt;/code>. See the &lt;a href="https://github.com/cloudevents/spec/blob/master/json-format.md#43-examples">example shown here&lt;/a>.&lt;/p>
&lt;h3 id="duplicationidempotency">Duplication/Idempotency&lt;/h3>
&lt;p>Earlier, I mentioned that the &lt;code>id&lt;/code> field identifies the event which producers ensure is unique for a given &lt;code>source&lt;/code>. If a duplicate event is re-sent (eg: retry of a queue) it may have the same id. How the consumers handle this is up to them and largely depends on the context of the event. For example: if we are sending a new UserCreated event in the system, it will usually be safe to treat this as an idempotent event using the &lt;code>id&lt;/code> as the idempotency key. It&amp;rsquo;s always up to the consumer to decide whether or not multiple events with the same &lt;code>source&lt;/code> and &lt;code>id&lt;/code> combination are treated as duplicates or not.&lt;/p>
&lt;h2 id="transports">Transports&lt;/h2>
&lt;p>CloudEvents may be sent across a variety of transport mechanisms, including:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/amqp-protocol-binding.md">AMQP&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/http-protocol-binding.md">HTTP&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/mqtt-protocol-binding.md">MQTT&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/nats-protocol-binding.md">NATS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/kafka-protocol-binding.md">Kafka&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/websockets-protocol-binding.md">WebSockets&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>The specification doesn&amp;rsquo;t explicitly include vendor specific transports like Azure Service Bus or SQS. CloudEvents can be mapped to these vendor specific transports pretty easily by using the &lt;a href="https://github.com/cloudevents/spec/blob/master/http-protocol-binding.md">HTTP&lt;/a> as a guide for this.&lt;/p>
&lt;h2 id="formats">Formats&lt;/h2>
&lt;p>As mentioned earlier, any implementation must support the JSON format, presumably because it&amp;rsquo;s one of the most widely used formats today. However, the specification details two other formats: &lt;a href="https://github.com/cloudevents/spec/blob/master/avro-format.md">Avro&lt;/a> &amp;amp; &lt;a href="https://github.com/cloudevents/spec/blob/master/protobuf-format.md">Protobuf&lt;/a>.&lt;/p>
&lt;p>The format that services decide to use is up to them, so long as the specification is followed. This allows great flexibility in the way systems are built.&lt;/p>
&lt;h2 id="specification-extensions">Specification extensions&lt;/h2>
&lt;p>Like any specification, it&amp;rsquo;s never a case of one size fits all. The CloudEvents specification allows itself to be extended. An extension adds additional attributes to the message so long as they follow the same naming convention and type system as the standard attributes. A number of extensions for some common use cases have already been documented:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/extensions/dataref.md">Dataref (Claim Check Pattern)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/extensions/distributed-tracing.md">Distributed Tracing&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/extensions/partitioning.md">Partitioning&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/extensions/sampled-rate.md">Sampling&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/spec/blob/master/extensions/sequence.md">Sequence&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>To write a custom extension, &lt;a href="https://github.com/cloudevents/spec/blob/master/documented-extensions.md">check here&lt;/a> first for prior art and implementation information.&lt;/p>
&lt;h2 id="sdk-support">SDK Support&lt;/h2>
&lt;p>At the time of writing, there are six different SDK&amp;rsquo;s at the moment to help people produce and consume CloudEvents:&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-go">GO&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-javascript">Javascript&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-java">Java&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-csharp">C#&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-ruby">Ruby&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudevents/sdk-python">Python&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>I think it&amp;rsquo;s definitely worth teams looking into the use of CloudEvents as an interoperability mechanism between teams that need to consume each others events. The specification may also be looked at with other CNCF projects, like the Serverless Workflow specification. There&amp;rsquo;s definitely a lot more that I need to go and unpack with the CloudEvents specification, but at a high level, I really like the approach that&amp;rsquo;s been taken and I hope you do as well.&lt;/p>
&lt;p>You can &lt;a href="https://github.com/cloudevents/spec/blob/master/spec.md">read the full specification here&lt;/a>.&lt;/p></description></item></channel></rss>
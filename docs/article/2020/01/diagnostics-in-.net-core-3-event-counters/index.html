<!doctype html><html lang="en"><head><title>Diagnostics in .Net Core 3: Event Counters | January | 2020 | Articles | CodeWithStu's Blog</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="A look into the EventCounters API in .Net Core 3"><meta name="keywords" content><link rel="icon" type="image/x-icon" href="https://im5tu.io/assets/favicon.ico"><link rel="canonical" href="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/"><meta property="og:url" content="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/"><meta property="og:type" content="website"><meta property="og:title" content="Diagnostics in .Net Core 3: Event Counters | January | 2020 | Articles | CodeWithStu's Blog"><meta property="og:description" content="A look into the EventCounters API in .Net Core 3"><meta property="og:image" content="/assets/profile.jpg"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:domain" content="im5tu.io"><meta property="twitter:url" content="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/"><meta name="twitter:title" content="Diagnostics in .Net Core 3: Event Counters | January | 2020 | Articles | CodeWithStu's Blog"><meta name="twitter:description" content="A look into the EventCounters API in .Net Core 3"><meta name="twitter:image" content="/assets/profile.jpg"><script defer data-domain="im5tu.io" src="https://plausible.io/js/script.js"></script><style type="text/css">*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::before,::after{--tw-content:''}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,liberation mono,courier new,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}table{width:100%;table-layout:auto;border-collapse:collapse;text-align:left;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}table:where([dir=rtl],[dir=rtl] *){text-align:right}@media(prefers-color-scheme:dark){table{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table th{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity));font-size:.75rem;line-height:1rem;text-transform:uppercase;--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table th{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity));--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}}table tbody tr{border-bottom-width:1px;--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity));vertical-align:top}@media(prefers-color-scheme:dark){table tbody tr{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity));--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}table td,table th{padding-left:1.5rem;padding-right:1.5rem;padding-top:1rem;padding-bottom:1rem;vertical-align:top}table tbody tr:first-child-of-type(td){white-space:nowrap;font-weight:500;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}@media(prefers-color-scheme:dark){table tbody tr:first-child-of-type(td){--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}}h1,h2,h3,h4,h5,h6{line-height:1;letter-spacing:-.025em;--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}h1,h2,h3{font-weight:800}h1{margin-top:2rem;margin-bottom:2rem;font-size:2.25rem;line-height:2.5rem}@media(min-width:768px){h1{font-size:3rem;line-height:1}}@media(min-width:1024px){h1{font-size:3.75rem;line-height:1}}h2{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1.875rem;line-height:2.25rem}h3{margin-top:1rem;margin-bottom:1rem;font-size:1.5rem;line-height:2rem}h4,h5,h6{margin-top:.75rem;margin-bottom:.75rem;font-weight:700}h4{font-size:1.25rem;line-height:1.75rem}p{padding-top:1rem;padding-bottom:1rem;font-size:1rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity))}p code,li code{font-weight:700;--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}p a:link,p a:visited{font-style:italic;--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}p a:link:hover,p a:visited:hover{--tw-text-opacity:1;color:rgb(154 52 18/var(--tw-text-opacity))}pre>code{display:block;overflow:auto;padding:1.5rem;font-weight:400}ul{list-style-position:inside;list-style-type:disc}ul>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}section ul ul,section ul ol,section ol ul{margin-left:1rem}ol{list-style-position:inside;list-style-type:decimal}ol>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}*,::before,::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.\!relative{position:relative!important}.relative{position:relative}.sticky{position:sticky}.inset-y-0{top:0;bottom:0}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-\[3\.5rem\]{top:3.5rem}.top-\[4\.5rem\]{top:4.5rem}.isolate{isolation:isolate}.z-50{z-index:50}.-m-2{margin:-.5rem}.-m-2\.5{margin:-.625rem}.m-0{margin:0}.-mx-3{margin-left:-.75rem;margin-right:-.75rem}.-my-6{margin-top:-1.5rem;margin-bottom:-1.5rem}.mx-12{margin-left:3rem;margin-right:3rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-3{margin-top:.75rem;margin-bottom:.75rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mb-0{margin-bottom:0}.mb-1{margin-bottom:.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-4{margin-left:1rem}.mt-0{margin-top:0}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.flow-root{display:flow-root}.contents{display:contents}.hidden{display:none}.h-0{height:0}.h-0\.5{height:.125rem}.h-12{height:3rem}.h-4{height:1rem}.h-48{height:12rem}.h-6{height:1.5rem}.h-screen{height:100vh}.w-12{width:3rem}.w-28{width:7rem}.w-4{width:1rem}.w-48{width:12rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.min-w-0{min-width:0}.min-w-\[25\%\]{min-width:25%}.min-w-\[7rem\]{min-width:7rem}.max-w-5xl{max-width:64rem}.max-w-\[1600px\]{max-width:1600px}.max-w-\[30\%\]{max-width:30%}.max-w-screen-xl{max-width:1280px}.max-w-2xl{max-width:42rem}.flex-auto{flex:auto}.flex-shrink-0{flex-shrink:0}.grow{flex-grow:1}.grow-0{flex-grow:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.list-disc{list-style-type:disc}.list-none{list-style-type:none}.flex-col{flex-direction:column}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.space-x-12>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(3rem * var(--tw-space-x-reverse));margin-left:calc(3rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-24>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(6rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(6rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.divide-gray-500\/10>:not([hidden])~:not([hidden]){border-color:rgb(107 114 128/.1)}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-900\/10{border-color:rgb(17 24 39/.1)}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225/var(--tw-border-opacity))}.border-slate-400{--tw-border-opacity:1;border-color:rgb(148 163 184/var(--tw-border-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[radial-gradient\(ellipse_at_top\2c _var\(--tw-gradient-stops\)\)\]{background-image:radial-gradient(ellipse at top,var(--tw-gradient-stops))}.from-gray-800{--tw-gradient-from:#1f2937 var(--tw-gradient-from-position);--tw-gradient-to:rgb(31 41 55 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-gray-900{--tw-gradient-to:rgb(17 24 39 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #111827 var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black{--tw-gradient-to:#000 var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pl-0{padding-left:0}.pl-0\.5{padding-left:.125rem}.pl-1{padding-left:.25rem}.pl-3{padding-left:.75rem}.pl-4{padding-left:1rem}.pr-8{padding-right:2rem}.text-center{text-align:center}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-5{line-height:1.25rem}.leading-6{line-height:1.5rem}.leading-7{line-height:1.75rem}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.blur{--tw-blur:blur(8px);filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.filter{filter:var(--tw-blur)var(--tw-brightness)var(--tw-contrast)var(--tw-grayscale)var(--tw-hue-rotate)var(--tw-invert)var(--tw-saturate)var(--tw-sepia)var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}.duration-200{transition-duration:200ms}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.hover\:text-orange-500:hover{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity))}.hover\:text-orange-600:hover{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity))}.hover\:text-slate-800:hover{--tw-text-opacity:1;color:rgb(30 41 59/var(--tw-text-opacity))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y))rotate(var(--tw-rotate))skewX(var(--tw-skew-x))skewY(var(--tw-skew-y))scaleX(var(--tw-scale-x))scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:block{display:block}@media(min-width:640px){.sm\:max-w-sm{max-width:24rem}.sm\:px-0{padding-left:0;padding-right:0}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:py-6{padding-top:1.5rem;padding-bottom:1.5rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.sm\:ring-gray-900\/10{--tw-ring-color:rgb(17 24 39 / 0.1)}}@media(min-width:768px){.md\:order-1{order:1}.md\:mt-0{margin-top:0}.md\:py-16{padding-top:4rem;padding-bottom:4rem}.md\:py-8{padding-top:2rem;padding-bottom:2rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:text-base{font-size:1rem;line-height:1.5rem}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media(min-width:1024px){.lg\:relative{position:relative}.lg\:top-0{top:0}.lg\:mb-0{margin-bottom:0}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:h-auto{height:auto}.lg\:w-\[50vw\]{width:50vw}.lg\:max-w-none{max-width:none}.lg\:max-w-\[1600px\]{max-width:1600px}.lg\:flex-1{flex:1}.lg\:flex-none{flex:none}.lg\:flex-row{flex-direction:row}.lg\:justify-center{justify-content:center}.lg\:bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.lg\:px-0{padding-left:0;padding-right:0}.lg\:px-8{padding-left:2rem;padding-right:2rem}.lg\:pl-8{padding-left:2rem}.lg\:pr-0{padding-right:0}.lg\:text-sm{font-size:.875rem;line-height:1.25rem}.lg\:shadow-none{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}}@media(min-width:1280px){.xl\:w-72{width:18rem}.xl\:px-12{padding-left:3rem;padding-right:3rem}.xl\:px-16{padding-left:4rem;padding-right:4rem}.xl\:pr-16{padding-right:4rem}}</style></head><body><header class="z-50"><nav class="flex items-end justify-between py-6 lg:px-8" aria-label="Global"><div class="flex lg:hidden pl-4"><button type="button" id="menuOpen" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700 hover:text-orange-500">
<span class="sr-only">Open main menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></button></div><div class="hidden lg:flex lg:flex-1 lg:justify-center"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-900 mx-12">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">About</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Articles</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Learn</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-900 hover:text-orange-500 mx-12">Videos</a></div></nav><div class="lg:hidden" role="dialog" aria-modal="true"><div class="fixed inset-y-0 left-0 z-50 w-full overflow-y-auto bg-white px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10 hidden" id="mobileMenu"><div class="flex items-center justify-between"><button type="button" class="-m-2.5 rounded-md p-2.5 text-gray-700" id="menuClose">
<span class="sr-only">Close menu</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="mt-6 flow-root"><div class="-my-6 divide-y divide-gray-500/10"><div class="space-y-2 py-6"><a href="https://im5tu.io/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Home</a>
<a href="https://im5tu.io/about/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">About</a>
<a href="https://im5tu.io/article/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Articles</a>
<a href="https://im5tu.io/learn/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Learn</a>
<a href="https://im5tu.io/video/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:text-orange-500">Videos</a></div></div></div></div></div></header><main class="isolate"><div class="bg-white px-6 py-8 lg:px-8"><article itemscope itemtype="https://schema.org/BlogPosting" class="mx-auto max-w-5xl text-base leading-7 text-gray-700"><meta itemprop="wordCount" content="2901"><meta itemprop="abstract" content="Recently, I&rsquo;ve been playing with the new diagnostic improvements in .Net Core 3. Traditionally, I&rsquo;ve always used the great AppMetrics package to capture the metrics from our applications and send scrape them with a Prometheus & Grafana setup. Whilst reading about the improvements, I wondered whether or not it would be possible to push metrics to Prometheus."><nav class="flex mb-6" aria-label="Breadcrumb"><ol role="list" class="flex items-center space-x-4 list-none" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="1"><meta itemprop="url item" content="https://im5tu.io/"><div><a href="https://im5tu.io/" class="text-gray-400 hover:text-orange-500"><svg class="h-4 w-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M9.293 2.293a1 1 0 011.414.0l7 7A1 1 0 0117 11h-1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3a1 1 0 00-1-1H9a1 1 0 00-1 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-6H3a1 1 0 01-.707-1.707l7-7z" clip-rule="evenodd"/></svg><span itemprop="name" class="sr-only">CodeWithStu</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="2"><meta itemprop="url item" content="https://im5tu.io/article/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">Articles</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="3"><meta itemprop="url item" content="https://im5tu.io/article/2020/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a href="https://im5tu.io/article/2020/" class="ml-4 text-sm font-medium text-gray-500 hover:text-orange-500"><span itemprop="name">2020</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="4"><meta itemprop="url item" content="https://im5tu.io/article/2020/01/"><div class="flex items-center"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">January</span></a></div></li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><meta itemprop="position" content="5"><div class="flex items-center"><meta itemprop="url item" content="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-event-counters/"><svg class="h-4 w-4 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75.0 01.02-1.06L11.168 10 7.23 6.29a.75.75.0 111.04-1.08l4.5 4.25a.75.75.0 010 1.08l-4.5 4.25a.75.75.0 01-1.06-.02z" clip-rule="evenodd"/></svg><a class="ml-4 text-sm font-medium text-gray-500 select-none"><span itemprop="name">Diagnostics in .Net Core 3: Event Counters</span></a></div></li></ol></nav><h1 itemprop="name headline" class="mt-2 mb-0 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Diagnostics in .Net Core 3: Event Counters</h1><div><div itemprop="author" itemscope itemtype="http://schema.org/Person" id="codewithstu" class="hidden"><meta itemprop="name" content="Stuart Blackler"><meta itemprop="jobTitle" content="Principal Software Engineer"><meta itemprop="description" content="I help you grow as a developer. I love to talk about #aws, #devops, #dotnet, #aspnetcore, and #opentelemetry"><meta itemprop="knowsAbout" content="AWS, DevOps, .NET, ASP.NET Core, OpenTelemetry, C#, .Net Core, Kubernetes, XUnit, Git, Github, FluentAssertions, SQL Server, Azure, Docker, Kubernetes, Apache Kafka, Elasticsearch, Redis, SAP Business One, WCF, TFSVC"><link itemprop="sameAs" href="https://twitter.com/CodeWithStu"><link itemprop="sameAs" href="https://bsky.app/profile/codewithstu.tv"><link itemprop="sameAs" href="https://github.com/im5tu"><link itemprop="sameAs" href="https://www.linkedin.com/in/codewithstu/"><link itemprop="sameAs" href="https://www.youtube.com/@CodeWithStu"><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Illuvium.io"><meta itemprop="url" content="https://illuvium.io/"><meta itemprop="description" content="Principle C# Engineer, January 2024 - Present. London, England, United Kingdom"></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Loupe"><meta itemprop="url" content="https://loupe.work"><meta itemprop="description" content="Principal Engineer, August 2022 - December 2023. London, England, United Kingdom. Guided teams, AWS infrastructure, reduced build times, updated coding standards."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Checkout.com"><meta itemprop="url" content="https://checkout.com"><meta itemprop="description" content="Principal Engineer, March 2021 - July 2022. London, England, United Kingdom. Technical direction, auditing/security architectures, AWS Organisational Accounts, observability & security packages."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="GfK"><meta itemprop="url" content="https://https://www.gfk.com/"><meta itemprop="description" content="Senior Software Engineer (Contract), October 2018 - June 2019. Slough, United Kingdom. Migrated crawling platform to AWS, performance troubleshooting, and growth strategies."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ClearBank"><meta itemprop="url" content="https://clear.bank"><meta itemprop="description" content="Lead Architect, June 2018 - October 2018. London, United Kingdom. Designed core infrastructure, Open Banking integration, technical workshops, and customer integrations."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="4Com"><meta itemprop="url" content="https://www.4com.co.uk/"><meta itemprop="description" content=".Net Developer, September 2014 - October 2016. Bournemouth, United Kingdom. Adopted high-availability solutions, re-designed legacy architectures, and mentored junior developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Codestone Group Ltd"><meta itemprop="url" content="https://www.codestone.net/"><meta itemprop="description" content="Software Engineer, August 2013 - September 2014. Poole, Dorset, United Kingdom. Implemented solutions for SMEs, introduced agile processes, and mentored developers."></div><div itemprop="worksFor" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cemoc"><meta itemprop="url" content="https://www.cemoc.co.uk/"><meta itemprop="description" content="Software Developer, October 2009 - August 2012. Wootton Bridge, Isle of Wight, United Kingdom. Worked with various sized companies, responsible for product lifecycle and client support."></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Bournemouth University"><meta itemprop="url" href="https://www.bournemouth.ac.uk/"><meta itemprop="description" content="BSc Computing, Advanced Networking and Data Mining (2012 - 2013)"></div><div itemprop="alumniOf" itemscope itemtype="http://schema.org/EducationalOrganization"><meta itemprop="name" content="Isle of Wight College"><meta itemprop="url" href="https://www.iwcollege.ac.uk/"><meta itemprop="description" content="HND, Computer And Software Development (2008 - 2010)"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCSD: Web Applications"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2014-05"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="MCP Programming C#"><meta itemprop="url" href="https://www.microsoft.com/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Microsoft"><meta itemprop="dateCreated" content="2013-06"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Developer – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-developer-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div><div itemprop="hasCredential" itemscope itemtype="http://schema.org/EducationalOccupationalCredential"><meta itemprop="name" content="AWS Certified Solutions Architect – Associate"><meta itemprop="url" href="https://aws.amazon.com/certification/certified-solutions-architect-associate/"><meta itemprop="educationalLevel" content="Certification"><meta itemprop="recognizedBy" content="Amazon Web Services (AWS)"><meta itemprop="dateCreated" content="2020-09"></div></div><p class="font-normal text-gray-400 text-xs md:text-base italic m-0">Posted by <a itemprop="url" href="https://im5tu.io/about">Stuart Blackler</a>
on <time itemprop="datePublished" datetime="2020-01-05 14:00:00 +0000 UTC">January 5, 2020</time>.
Last Updated on <time itemprop="dateModified" datetime="2024-01-11T21:57:56Z">January 11, 2024</time>.
Tagged:<span class="inline mx-2 font-small"><a href="https://im5tu.io/%20tags/dotnet/" title="dotnet" class="hover:text-orange-500">dotnet</a></span></p></div><nav class="mb-2 bg-slate-50 p-6 w-fit rounded-lg"><h4 class="mt-0">Table of Contents</h4><ul class="space-y-1 pl-1 list-disc"><li><a class="hover:text-orange-600" href="#application-flow">Application Flow</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#using-eventcounters-and-eventsource-events">Using EventCounters And EventSource Events</a></li><li><a class="hover:text-orange-600" href="#other-eventsource-examples">Other EventSource Examples</a></li></ul><li><a class="hover:text-orange-600" href="#types-of-diagnosticcounters">Types of DiagnosticCounters</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#eventcounter">EventCounter</a></li><li><a class="hover:text-orange-600" href="#incrementingeventcounter">IncrementingEventCounter</a></li><li><a class="hover:text-orange-600" href="#pollingcounter">PollingCounter</a></li><li><a class="hover:text-orange-600" href="#incrementingpollingcounter">IncrementingPollingCounter</a></li></ul><li><a class="hover:text-orange-600" href="#under-the-hood">Under the hood</a></li><li><a class="hover:text-orange-600" href="#listening-for-event-counters">Listening for event counters</a></li><ul class="space-y-1 pl-4 list-disc"><li><a class="hover:text-orange-600" href="#consuming-eventcounters-using-dotnet-counters">Consuming EventCounters using dotnet-counters</a></li><li><a class="hover:text-orange-600" href="#consuming-eventcounters-within-our-applications">Consuming EventCounters within our applications</a></li></ul></ul></nav><section itemprop="articleBody"><p>Recently, I&rsquo;ve been playing with the new <a href="https://devblogs.microsoft.com/dotnet/introducing-diagnostics-improvements-in-net-core-3-0/">diagnostic improvements in .Net Core 3</a>. Traditionally, I&rsquo;ve always used the great <a href="https://github.com/AppMetrics/AppMetrics">AppMetrics</a> package to capture the metrics from our applications and send scrape them with a <a href="https://github.com/prometheus/prometheus">Prometheus</a> & <a href="https://github.com/grafana/grafana">Grafana</a> setup. Whilst reading about the improvements, I wondered whether or not it would be possible to push metrics to <a href="https://github.com/prometheus/prometheus">Prometheus</a>.</p><p>Ultimately, I decided that pushing to <a href="https://github.com/prometheus/prometheus">Prometheus</a> wasn&rsquo;t ideal for my use case. However, I have successfully used the approach described in the rest of the article to push the metrics to another platform, using a new .Net API - EventCounters.</p><p>EventCounters are the .NET Core replacement for Windows performance counters, which are now cross platform. EventCounters are based on the EventPipe that was originally introduced in .Net Core 2.2, but .Net Core 3.0+ adds a lot of additional functionality that we can use going forward to create cross platform monitoring tools for our applications including:</p><ul><li><code>dotnet-dump</code> takes memory snapshot and allow analysis based on most SOS commands;</li><li><code>dotnet-trace</code> collects events emitted by the Core CLR and generate trace file to be analyzed with PerfView;</li><li><code>dotnet-counters</code> collects the metrics corresponding to some performance counters that used to be exposed by the .NET Framework.</li></ul><p><em>Please note that this article is correct at the time of writing based on the <a href="https://source.dot.net">sources</a> available. I do describe some of the internal workings of the API, which may change overtime.</em></p><h2 id="application-flow">Application Flow</h2><p>In order to use the new EventCounters API, you first need to create an inherited class that derives from EventSource because every type of counter needs to be registered against an EventSource. Let&rsquo;s start off with the simplist possible EventSource that records metrics dynamically:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[EventSource(Name = &#34;MyApplication&#34;)]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyApplicationEventSource</span> : EventSource
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> MyApplicationEventSource Instance = <span style="color:#66d9ef">new</span> MyApplicationEventSource();
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ConcurrentDictionary&lt;<span style="color:#66d9ef">string</span>, EventCounter&gt; _dynamicCounters = <span style="color:#66d9ef">new</span> ConcurrentDictionary&lt;<span style="color:#66d9ef">string</span>, EventCounter&gt;();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> MyApplicationEventSource() {}
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> RecordMetric(<span style="color:#66d9ef">string</span> name, <span style="color:#66d9ef">float</span> <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrWhiteSpace(name)) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> counter = _dynamicCounters.GetOrAdd(name, key =&gt; <span style="color:#66d9ef">new</span> EventCounter(key, <span style="color:#66d9ef">this</span>));
</span></span><span style="display:flex"><span>        counter.WriteMetric(<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>In order to initialize a new EventCounter instance, we need to give a name and the EventSource that it should be associated with. Whilst this is okay for simple EventCounters, we often need to do more with our applications, such as tracking the start/stopping of certain events, or tracking activities using PerfView. To do this, we can leverage more of the EventSource&rsquo;s infrastructure.</p><h3 id="using-eventcounters-and-eventsource-events">Using EventCounters And EventSource Events</h3><p>Let&rsquo;s breakdown the following example, which I&rsquo;ve taken from my <a href="https://github.com/Im5tu/OpenMessage/blob/dev/src/OpenMessage/OpenMessageEventSource.cs">OpenMessage project</a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[EventSource(Name = &#34;OpenMessage&#34;)]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OpenMessageEventSource</span> : EventSource
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> OpenMessageEventSource Instance = <span style="color:#66d9ef">new</span> OpenMessageEventSource();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> _inflightMessages = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> _processedCount = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> IncrementingPollingCounter _inflightMessagesCounter;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> EventCounter _messageDurationCounter;
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> IncrementingPollingCounter _processedCountCounter;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> OpenMessageEventSource() { }
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">    [NonEvent]</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> ValueStopwatch? ProcessMessageStart()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (!IsEnabled()) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        MessageStart();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> ValueStopwatch.StartNew();
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">    [Event(1, Level = EventLevel.Informational, Message = &#34;Consumed Message&#34;)]</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MessageStart()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        Interlocked.Increment(<span style="color:#66d9ef">ref</span> _inflightMessages);
</span></span><span style="display:flex"><span>        Interlocked.Increment(<span style="color:#66d9ef">ref</span> _processedCount);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">    [NonEvent]</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ProcessMessageStop(ValueStopwatch stopwatch)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (!IsEnabled()) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        MessageStop(stopwatch.IsActive ? stopwatch.GetElapsedTime().TotalMilliseconds : <span style="color:#ae81ff">0.0</span>);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">    [Event(2, Level = EventLevel.Informational, Message = &#34;Message Completed&#34;)]</span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MessageStop(<span style="color:#66d9ef">double</span> duration)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        Interlocked.Decrement(<span style="color:#66d9ef">ref</span> _inflightMessages);
</span></span><span style="display:flex"><span>        _messageDurationCounter.WriteMetric(duration);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventCommand(EventCommandEventArgs command)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (command.Command == EventCommand.Enable)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            _inflightMessagesCounter ??= <span style="color:#66d9ef">new</span> IncrementingPollingCounter(<span style="color:#e6db74">&#34;inflight-messages&#34;</span>, <span style="color:#66d9ef">this</span>, () =&gt; _inflightMessages)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                DisplayName = <span style="color:#e6db74">&#34;Inflight Messages&#34;</span>,
</span></span><span style="display:flex"><span>                DisplayUnits = <span style="color:#e6db74">&#34;Messages&#34;</span>
</span></span><span style="display:flex"><span>            };
</span></span><span style="display:flex"><span>            _messageDurationCounter ??= <span style="color:#66d9ef">new</span> EventCounter(<span style="color:#e6db74">&#34;message-duration&#34;</span>, <span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                DisplayName = <span style="color:#e6db74">&#34;Average Message Duration&#34;</span>,
</span></span><span style="display:flex"><span>                DisplayUnits = <span style="color:#e6db74">&#34;ms&#34;</span>
</span></span><span style="display:flex"><span>            };
</span></span><span style="display:flex"><span>            _processedCountCounter ??= <span style="color:#66d9ef">new</span> IncrementingPollingCounter(<span style="color:#e6db74">&#34;processed-count&#34;</span>, <span style="color:#66d9ef">this</span>, () =&gt; _processedCount)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                DisplayName = <span style="color:#e6db74">&#34;Messages Processed&#34;</span>,
</span></span><span style="display:flex"><span>                DisplayRateTimeScale = TimeSpan.FromSeconds(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>            };
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// ... code omitted for brevity</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>The example above is designed to track the number of messages processed by our system, and how long on average they took to process. The event source is also designed to be lazily initialized, so we only track information when the EventSource is enabled. Let&rsquo;s take a look at how we&rsquo;ve accomplished this by looking at <code>OnEventCommand</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventCommand(EventCommandEventArgs command)
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> (command.Command == EventCommand.Enable)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _inflightMessagesCounter ??= <span style="color:#66d9ef">new</span> IncrementingPollingCounter(<span style="color:#e6db74">&#34;inflight-messages&#34;</span>, <span style="color:#66d9ef">this</span>, () =&gt; _inflightMessages)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            DisplayName = <span style="color:#e6db74">&#34;Inflight Messages&#34;</span>,
</span></span><span style="display:flex"><span>            DisplayUnits = <span style="color:#e6db74">&#34;Messages&#34;</span>
</span></span><span style="display:flex"><span>        };
</span></span><span style="display:flex"><span>        _messageDurationCounter ??= <span style="color:#66d9ef">new</span> EventCounter(<span style="color:#e6db74">&#34;message-duration&#34;</span>, <span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            DisplayName = <span style="color:#e6db74">&#34;Average Message Duration&#34;</span>,
</span></span><span style="display:flex"><span>            DisplayUnits = <span style="color:#e6db74">&#34;ms&#34;</span>
</span></span><span style="display:flex"><span>        };
</span></span><span style="display:flex"><span>        _processedCountCounter ??= <span style="color:#66d9ef">new</span> IncrementingPollingCounter(<span style="color:#e6db74">&#34;processed-count&#34;</span>, <span style="color:#66d9ef">this</span>, () =&gt; _processedCount)
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            DisplayName = <span style="color:#e6db74">&#34;Messages Processed&#34;</span>,
</span></span><span style="display:flex"><span>            DisplayRateTimeScale = TimeSpan.FromSeconds(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>        };
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>This is where we register the event counters that we are interested in tracking. EventSource&rsquo;s can receive commands from external sources, so that they can enable the EventCounter API etc. We can receive this message from applications multiple times, so it&rsquo;s important to to make sure that we defensively programme. In the sample above, I use the new null-assignment expression to ensure that only when the field is null, do we perform the expression on the right hand side - which in our case is creating the counters.</p><p>There are four available types of counters available for us to use, which I will cover later on:</p><ul><li>EventCounter</li><li>IncrementingEventCounter</li><li>PollingCounter</li><li>IncrementingPollingCounter</li></ul><p>Next, we need to look how we can actually record the metrics. In order to do this, I&rsquo;ve combined it with using EventSource Event&rsquo;s so that I can also get the information that I want inside of other tools like PerfView should I want to:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#a6e22e">[NonEvent]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> ValueStopwatch? ProcessMessageStart()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> (!IsEnabled()) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    MessageStart();
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">return</span> ValueStopwatch.StartNew();
</span></span><span style="display:flex"><span>}
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">[Event(1, Level = EventLevel.Informational, Message = &#34;Consumed Message&#34;)]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MessageStart()
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    Interlocked.Increment(<span style="color:#66d9ef">ref</span> _inflightMessages);
</span></span><span style="display:flex"><span>    Interlocked.Increment(<span style="color:#66d9ef">ref</span> _processedCount);
</span></span><span style="display:flex"><span>}
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">[NonEvent]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ProcessMessageStop(ValueStopwatch stopwatch)
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> (!IsEnabled()) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    MessageStop(stopwatch.IsActive ? stopwatch.GetElapsedTime().TotalMilliseconds : <span style="color:#ae81ff">0.0</span>);
</span></span><span style="display:flex"><span>}
</span></span><span style="display:flex"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex"><span><span style="color:#a6e22e">[Event(2, Level = EventLevel.Informational, Message = &#34;Message Completed&#34;)]</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MessageStop(<span style="color:#66d9ef">double</span> duration)
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    Interlocked.Decrement(<span style="color:#66d9ef">ref</span> _inflightMessages);
</span></span><span style="display:flex"><span>    _messageDurationCounter.WriteMetric(duration);
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>We have two operations that we are really interested in Start & Stop. In the example above, each of the operations is split out into a <code>[NonEvent]</code> and a corresponding <code>[Event]</code>. The <code>[Event]</code> is what the EventSource system uses to write the events to the underlying stream so that it can be picked up by tools such as PerfView. The entry point is always the <code>[NonEvent]</code> so that we can check to see if anyone is listening to the EventSource before we do anything, this helps ensure that it does not emit the Event unnecessarily. This is the same pattern that is used throughout the .Net Code base from what I can tell.</p><p>For the <code>[Event]</code>&rsquo;s, you will notice that the Start/Stop is EventId 1/2 respectively and the also end with Start/Stop. This allows some magic to happen such as automatically figuring out the duration inside of PerfView. For more information on some of the magic that occurs, I strongly recommend reading <a href="https://blogs.msdn.microsoft.com/vancem/2015/09/14/exploring-eventsource-activity-correlation-and-causation-features/">Vance Morrison&rsquo;s Excellent Blog Post</a> instead of me duplicating the knowledge here.</p><p>Once you have your EventSource configured, and you know which metrics you wish to track, then all that&rsquo;s left is to start recording your metrics (eg: <code>OpenMessageEventSource.ProcessMessageStart()</code>) and the runtime will take care of the rest.</p><h3 id="other-eventsource-examples">Other EventSource Examples</h3><p>For some inspiration of how to configure your EventSource&rsquo;s, here are a few examples from Microsoft:</p><ul><li><a href="https://github.com/aspnet/AspNetCore/blob/master/src/Hosting/Hosting/src/Internal/HostingEventSource.cs">HostingEventSource</a>: Used to track the current number of requests including: failed/total/requests per second.</li><li><a href="https://github.com/aspnet/AspNetCore/blob/master/src/Servers/Kestrel/Core/src/Internal/Infrastructure/KestrelEventSource.cs">KestrelEventSource</a>: Used to track details of connections to the Kestrel WebServer - including when connections and requests Start/Stop.</li><li><a href="https://github.com/aspnet/AspNetCore/blob/master/src/Middleware/ConcurrencyLimiter/src/ConcurrencyLimiterEventSource.cs">ConcurrencyLimiterEventSource</a>: Used to track the number of queued requests and the duration in the queue.</li></ul><h2 id="types-of-diagnosticcounters">Types of DiagnosticCounters</h2><p>The <code>DiagnosticCounter</code> class is the abstract base class that all of the event counters types inherit from. Currently, there are four implementations registered in the <a href="https://source.dot.net/#Microsoft.Diagnostics.Tracing.EventSource/DiagnosticCounter.cs,28677f9e15895cc9,references">source</a>: <code>EventCounter</code>, <code>IncrementingEventCounter</code>, <code>PollingCounter</code> and <code>IncrementingPollingCounter</code>. Although abstract, we can&rsquo;t really inherit from <code>DiagnosticCounter</code> as the internal components that we need, which are described below, are protected from external use. The four implementations that I mentioned, appear to cover pretty much every use case that I can think of anyway.</p><h3 id="eventcounter">EventCounter</h3><p>This type of event counter is typically used for tracking latency of requests to external parties due to the aggregated stats that this type provides. An EventCounter instance tracks the following about the metrics that it&rsquo;s recorded:</p><table><thead><tr><th>Name</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>Name</td><td>string</td><td></td></tr><tr><td>DisplayName</td><td>string</td><td></td></tr><tr><td>Mean</td><td>double</td><td>The average of all values recorded</td></tr><tr><td>StandardDeviation</td><td>double</td><td></td></tr><tr><td>Count</td><td>int</td><td>How many metric entries were recorded in this iteration</td></tr><tr><td>Min</td><td>double</td><td></td></tr><tr><td>Max</td><td>double</td><td></td></tr><tr><td>IntervalSec</td><td>float</td><td></td></tr><tr><td>CounterType</td><td>string</td><td>Always &ldquo;Mean&rdquo;</td></tr><tr><td>Metadata</td><td>string</td><td>Any associated metadata for this specific counter</td></tr><tr><td>DisplayUnits</td><td>string</td><td></td></tr><tr><td>Series</td><td>string</td><td>Format is: $&ldquo;IntervalSec={IntervalSec}&rdquo;</td></tr></tbody></table><p>In order to write data, you need to call <code>&lt;counter>.WriteMetric(value)</code>.</p><h3 id="incrementingeventcounter">IncrementingEventCounter</h3><p>An IncrementingEventCounter is typically used to track ever increasing numbers such as the total number of requests. Unlike it&rsquo;s namesake, EventCounter, this class does not provide any statistics about the data. In other words, it is a pure counter, so only the following information is tracked:</p><table><thead><tr><th>Name</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>Name</td><td>string</td><td></td></tr><tr><td>DisplayName</td><td>string</td><td></td></tr><tr><td>DisplayRateTimeScale</td><td>string</td><td>The unit of measure that the metric should be shown in, eg: per-second</td></tr><tr><td>Increment</td><td>double</td><td>The value of the this is: currentValue - previousValue</td></tr><tr><td>IntervalSec</td><td>float</td><td></td></tr><tr><td>Metadata</td><td>string</td><td></td></tr><tr><td>Series</td><td>string</td><td>Format is: $&ldquo;IntervalSec={IntervalSec}&rdquo;</td></tr><tr><td>CounterType</td><td>string</td><td>Always &ldquo;Sum&rdquo;</td></tr><tr><td>DisplayUnits</td><td>string</td><td></td></tr></tbody></table><p>In order to write data, you need to call <code>&lt;counter>.Increment(value)</code>. The <code>Increment</code> that you receive is always <code>currentValue - previousValue</code>.</p><h3 id="pollingcounter">PollingCounter</h3><p>A PollingCounter is very much like a standard EventCounter, but instead of the metric being written to it, a function is invoked which retrieves the value from your source of choice. An PollingCounter instance tracks the following about the metrics that it&rsquo;s recorded:</p><table><thead><tr><th>Name</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>Name</td><td>string</td><td></td></tr><tr><td>DisplayName</td><td>string</td><td></td></tr><tr><td>Mean</td><td>double</td><td>The average of all values recorded</td></tr><tr><td>StandardDeviation</td><td>double</td><td></td></tr><tr><td>Count</td><td>int</td><td>How many metric entries were recorded in this iteration</td></tr><tr><td>Min</td><td>double</td><td></td></tr><tr><td>Max</td><td>double</td><td></td></tr><tr><td>IntervalSec</td><td>float</td><td></td></tr><tr><td>CounterType</td><td>string</td><td>Always &ldquo;Mean&rdquo;</td></tr><tr><td>Metadata</td><td>string</td><td>Any associated metadata for this specific counter</td></tr><tr><td>DisplayUnits</td><td>string</td><td></td></tr><tr><td>Series</td><td>string</td><td>Format is: $&ldquo;IntervalSec={IntervalSec}&rdquo;</td></tr></tbody></table><h3 id="incrementingpollingcounter">IncrementingPollingCounter</h3><p>A IncrementingPollingCounter is very much like a standard IncrementingEventCounter, but instead of the metric being written to it, a function is invoked which retrieves the value from your source of choice. An IncrementingPollingCounter instance tracks the following about the metrics that it&rsquo;s recorded:</p><table><thead><tr><th>Name</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>Name</td><td>string</td><td></td></tr><tr><td>DisplayName</td><td>string</td><td></td></tr><tr><td>DisplayRateTimeScale</td><td>string</td><td>The unit of measure that the metric should be shown in, eg: per-second</td></tr><tr><td>Increment</td><td>double</td><td>The value of the this is: currentValue - previousValue</td></tr><tr><td>IntervalSec</td><td>float</td><td></td></tr><tr><td>Metadata</td><td>string</td><td></td></tr><tr><td>Series</td><td>string</td><td>Format is: $&ldquo;IntervalSec={IntervalSec}&rdquo;</td></tr><tr><td>CounterType</td><td>string</td><td>Always &ldquo;Sum&rdquo;</td></tr><tr><td>DisplayUnits</td><td>string</td><td></td></tr></tbody></table><h2 id="under-the-hood">Under the hood</h2><p>Now that we&rsquo;ve taken a look at how we construct the EvenSource so that we can create our application level metrics, we should also take a look at what happens under the hood so we can begin to complete the circle. Once you start creating any of the listed DiagnosticCounters in your application - the counter calls a method which ensures that the counter gets added to a <code>CounterGroup</code> associated with the specified EventSource. When a DiagnosticCounter is disposed, then it is removed from the CounterGroup and no longer tracked.</p><p>The <code>CounterGroup</code> is responsible for maintaining a thread that polls the DiagnosticCounters on the specified interval and updates their values. The thread isn&rsquo;t created until such time as an application calls <code>EnableEvents(eventSource, EventLevel.LogAlways, EventKeywords.All, new Dictionary&lt;string, string>{{"EventCounterIntervalSec", "1"}});</code> on an EventSource. Lastly, when the value of each DiagnosticCounter is updated, an event is raised against the EventSource that was passed to the counter which means that we can listen to this in the same way that we listen to other events on EventSource&rsquo;s - eg: PerfView/EventListener.</p><p>The whole EventSource system is very lightweight and designed for scalability in systems that generate millions of events - so we should not be too concerned about the performance of this. Naturally, the more that you listen to, the more impact this will have. I think it&rsquo;s safe to say, the code that we write in the listeners will likely be the slowest part of this system.</p><h2 id="listening-for-event-counters">Listening for event counters</h2><p>Lastly, in order to complete our circle, we need to be able to listen to the counters that we&rsquo;ve created in our applications. There are two common approaches that we can use: the CLI tool <code>dotnet-counters</code> or from within our applications using an <code>EventListener</code>.</p><h3 id="consuming-eventcounters-using-dotnet-counters">Consuming EventCounters using dotnet-counters</h3><p>As part of the diagnostic improvements in .Net Core 3, the .Net team introduced a new diagnostics tool called <code>dotnet-counters</code>. This is a stand-alone tool that can be installed using the following command:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet tool install dotnet-counters --global
</span></span></code></pre></div><p>Or updated to the latest version if you already have it installed:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet tool update dotnet-counters --global
</span></span></code></pre></div><p>After the tool has been installed, you can see the processes that are eligible for attaching to, using:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet-counters ps
</span></span><span style="display:flex"><span>    10416 dotnet     C:\Program Files\dotnet\dotnet.exe
</span></span><span style="display:flex"><span>    20660 dotnet     C:\Program Files\dotnet\dotnet.exe
</span></span><span style="display:flex"><span>    21172 dotnet     C:\Program Files\dotnet\dotnet.exe
</span></span></code></pre></div><p>Once you know the process that you want to attach to, you can start monitoring with the following command:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet-counters monitor -p 21172
</span></span></code></pre></div><p>If you are interested in specific EventSources, then you can supply a space separated list of EventSources like:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet-counters monitor -p 21172 System.Runtime MyEventSource
</span></span></code></pre></div><p>By default, when you ask to monitor an EventSource, it will capture and display all the counters for you. If no EventSources are specified then a default list is used, including: <code>System.Runtime</code>. If you only wish to track a few counters from each EventSource, then you specify them in square brackets directly after the EventSource name:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet-counters monitor -p 21172 System.Runtime[cpu-usage] MyEventSource[test]
</span></span></code></pre></div><p>All of the monitor commands will output something similar to the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>Press p to pause, r to resume, q to quit.
</span></span><span style="display:flex"><span>    Status: Running
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>[System.Runtime]
</span></span><span style="display:flex"><span>    CPU Usage (%)                                      0
</span></span><span style="display:flex"><span>[MyEventSource]
</span></span><span style="display:flex"><span>    test                                             335
</span></span></code></pre></div><p>Lastly, should you wish to control the rate that the counters are refreshed, supply the <code>--refresh-interval</code> parameter:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="display:flex"><span>dotnet-counters monitor -p 21172 --refresh-interval 5 System.Runtime[cpu-usage] MyEventSource[test]
</span></span></code></pre></div><h3 id="consuming-eventcounters-within-our-applications">Consuming EventCounters within our applications</h3><p>In order to enable tracing from within a .Net application you need three core parts:</p><ol><li>Class inheriting from EventListener</li><li>Detecting of EventSource&rsquo;s</li><li>Processing of Events</li></ol><h4 id="creating-our-eventlistener">Creating our EventListener</h4><p>For our new EventListener, I will create a simple background service as follows:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MetricsCollectionService</span> : EventListener, IHostedService
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StartAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StopAsync(CancellationToken cancellationToken) =&gt; Task.CompletedTask;
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>This will live for the lifetime of the application and host the task that will detect lazily initiated EventSources, such as the OpenMessage one I showed earlier in this article.</p><h4 id="detecting-eventsources">Detecting EventSources</h4><p>In order to detect the lazily initiated EventSources, we need to periodically call the method <code>EventSource.GetSources()</code> which lists all of the currently available sources. we can do this from a simple task that lives against the service:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MetricsCollectionService</span> : EventListener, IHostedService
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> List&lt;<span style="color:#66d9ef">string</span>&gt; RegisteredEventSources = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> Task _newDataSourceTask;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StartAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _newDataSourceTask = Task.Run(<span style="color:#66d9ef">async</span> () =&gt;
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                GetNewSources();
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">await</span> Task.Delay(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>        });
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StopAsync(CancellationToken cancellationToken) =&gt; Task.CompletedTask;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventSourceCreated(EventSource eventSource)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (!RegisteredEventSources.Contains(eventSource.Name))
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            RegisteredEventSources.Add(eventSource.Name);
</span></span><span style="display:flex"><span>            EnableEvents(eventSource, EventLevel.LogAlways, EventKeywords.All, <span style="color:#66d9ef">new</span> Dictionary&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>&gt;
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                {<span style="color:#e6db74">&#34;EventCounterIntervalSec&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>}
</span></span><span style="display:flex"><span>            });
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> GetNewSources()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> eventSource <span style="color:#66d9ef">in</span> EventSource.GetSources())
</span></span><span style="display:flex"><span>            OnEventSourceCreated(eventSource);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>We&rsquo;ve got a list of the EventSources that we have already asked to be enabled so that we don&rsquo;t continually ask them to enable themselves. This helps guard against any slightly mis-constructed EventSources, though not strictly necessary.</p><h4 id="processing-events">Processing Events</h4><p>The last bit for us to do is to override the <code>OnEventWritten</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventWritten(EventWrittenEventArgs eventData)
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> (eventData.EventName != <span style="color:#e6db74">&#34;EventCounters&#34;</span>
</span></span><span style="display:flex"><span>            || eventData.Payload.Count &lt;= <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>            || !(eventData.Payload[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">is</span> IDictionary&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; data)
</span></span><span style="display:flex"><span>            || !data.TryGetValue(<span style="color:#e6db74">&#34;CounterType&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> counterType)
</span></span><span style="display:flex"><span>            || !data.TryGetValue(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> name))
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">var</span> metricType = counterType.ToString();
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">float</span> metricValue = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;Sum&#34;</span>.Equals(metricType) &amp;&amp; data.TryGetValue(<span style="color:#e6db74">&#34;Increment&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> increment))
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        metricValue = Convert.ToSingle(increment);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;Mean&#34;</span>.Equals(metricType) &amp;&amp; data.TryGetValue(<span style="color:#e6db74">&#34;Mean&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> mean))
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        metricValue = Convert.ToSingle(mean);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#75715e">// do something with your metric here...</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>This method gets called for each EventSource that you have asked to receive the data from. It will be up to you to decide your own filtering policy. For each <code>EventWrittenEventArgs</code> that you receive, you need to double check that you have received an EventCounter before proceeding. Next, you need to check the payload that you received is indeed a <code>IDictionary&lt;string, object></code>, so that you can process the contents in a quick and efficient manner. Although in the implementations, there is a strongly typed class for the payload for each of the built in counters, it is internal so we are unable to consume it here. The last piece of the puzzle is for you to process the metric however you wish, ie: sending to DataDog.</p><p>Putting all of the above code together, we get something like the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="display:flex"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MetricsCollectionService</span> : EventListener, IHostedService
</span></span><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> List&lt;<span style="color:#66d9ef">string</span>&gt; RegisteredEventSources = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> Task _newDataSourceTask;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StartAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        _newDataSourceTask = Task.Run(<span style="color:#66d9ef">async</span> () =&gt;
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                GetNewSources();
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">await</span> Task.Delay(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex"><span>            }
</span></span><span style="display:flex"><span>        });
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">public</span> Task StopAsync(CancellationToken cancellationToken) =&gt; Task.CompletedTask;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventSourceCreated(EventSource eventSource)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (!RegisteredEventSources.Contains(eventSource.Name))
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            RegisteredEventSources.Add(eventSource.Name);
</span></span><span style="display:flex"><span>            EnableEvents(eventSource, EventLevel.LogAlways, EventKeywords.All, <span style="color:#66d9ef">new</span> Dictionary&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>&gt;
</span></span><span style="display:flex"><span>            {
</span></span><span style="display:flex"><span>                {<span style="color:#e6db74">&#34;EventCounterIntervalSec&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>}
</span></span><span style="display:flex"><span>            });
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnEventWritten(EventWrittenEventArgs eventData)
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (eventData.EventName != <span style="color:#e6db74">&#34;EventCounters&#34;</span>
</span></span><span style="display:flex"><span>                || eventData.Payload.Count &lt;= <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>                || !(eventData.Payload[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">is</span> IDictionary&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">object</span>&gt; data)
</span></span><span style="display:flex"><span>                || !data.TryGetValue(<span style="color:#e6db74">&#34;CounterType&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> counterType)
</span></span><span style="display:flex"><span>                || !data.TryGetValue(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> name))
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">var</span> metricType = counterType.ToString();
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">float</span> metricValue = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;Sum&#34;</span>.Equals(metricType) &amp;&amp; data.TryGetValue(<span style="color:#e6db74">&#34;Increment&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> increment))
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            metricValue = Convert.ToSingle(increment);
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;Mean&#34;</span>.Equals(metricType) &amp;&amp; data.TryGetValue(<span style="color:#e6db74">&#34;Mean&#34;</span>, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> mean))
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            metricValue = Convert.ToSingle(mean);
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>        <span style="color:#75715e">// do something with your metric here...</span>
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> GetNewSources()
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> eventSource <span style="color:#66d9ef">in</span> EventSource.GetSources())
</span></span><span style="display:flex"><span>            OnEventSourceCreated(eventSource);
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Hopefully at this point, you have enough information on how to use the built in counters and creating your own metrics. Let me know on <a href="https://twitter.com/im5tu">Twitter</a> if you have any thoughts or comments on the contents of this post.</p><p>Thanks for reading, happy counting! :)</p></section><div class="mt-4 border-t border-slate-400"><p><a href="https://im5tu.io/about/" title="About Stuart Blackler">Stuart Blackler</a> is a seasoned technologist with over 15 years of commercial experience in the .NET ecosystem.
Holding a degree in Computer Science, Stuart has earned
certifications as a C# developer through Microsoft and as an AWS Solutions Architect and Developer. Stuart is
the creator of the popular YouTube channel <a href="https://youtube.com/@codewithstu">CodeWithStu</a>, where he delves into topics close to his heart, including .NET, AWS, DevOps,
and software architecture with a commitment to sharing knowledge and fostering a community of learners.</p></div><div class="mt-4 border-t border-slate-400"><p><a name="series"></a><b>More in the <i>'Diagnostics in .Net Core 3'</i> series:</b></a></p><ol><li><a href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-an-alternative-approach-to-using-dotnet-counters-with-docker/">Diagnostics in .Net Core 3: An alternative approach to using dotnet-counters with Docker</a></li><li><a href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-inbound-http-requests/">Diagnostics in .Net Core 3: Listening to inbound HTTP requests</a></li><li><a href="https://im5tu.io/article/2020/06/diagnostics-in-.net-core-3-listening-to-outbound-http-requests/">Diagnostics in .Net Core 3: Listening to outbound HTTP requests</a></li><li><a href="https://im5tu.io/article/2020/01/diagnostics-in-.net-core-3-using-dotnet-counters-with-docker/">Diagnostics in .Net Core 3: Using dotnet-counters with Docker</a></li><li><b>Diagnostics in .Net Core 3: Event Counters <i>(This article)</i></b></li></ol></div></article></div></main><footer class="border-t border-gray-900/10 py-12 sm:py-6 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-gray-800 via-gray-900 to-black"><div><div class="hidden lg:flex lg:flex-1 justify-center mb-12"><a href="https://im5tu.io/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Home</a>
<a href="https://im5tu.io/about/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">About</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/article/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Articles</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/learn/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Learn</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a>
<a href="https://im5tu.io/video/" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Videos</a>
<a href="https://trycleo.co" class="text-sm font-semibold leading-6 text-gray-400 hover:text-gray-200 mx-4">Try Cleo</a></div><div class="flex justify-center space-x-12 my-6"><a href="https://www.youtube.com/@CodeWithStu?sub_confirmation=1" class="text-gray-400 hover:text-orange-500" target="_blank" title="Subscribe To Me On YouTube"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></svg></a><a href="https://www.linkedin.com/in/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Connect With Me LinkedIn"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.98 3.5C4.98 4.881 3.87 6 2.5 6s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zM5 8H0v16h5V8zm7.982.0H8.014v16h4.969v-8.399c0-4.67 6.029-5.052 6.029.0V24H24V13.869c0-7.88-8.922-7.593-11.018-3.714V8z"/></svg></a><a href="https://github.com/im5tu" class="text-gray-400 hover:text-orange-500" target="_blank" title="Follow Me On GitHub"><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-xs leading-5 text-gray-500">&copy; 2023 <a href="https://im5tu.io/" class="hover:text-orange-500">im5tu.io</a> - All rights reserved.</p></div></div></footer><script>document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("menuOpen"),t=document.getElementById("menuClose"),n=document.getElementById("mobileMenu");t&&e&&(t.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}),e.addEventListener("click",e=>{n.classList.toggle("hidden"),e.preventDefault()}))})</script></body></html>